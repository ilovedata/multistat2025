<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ko" xml:lang="ko"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.34">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>9&nbsp; 군집 분석 – 다변량통계학-2025년 2학기</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../qmd/multivar-anova.html" rel="next">
<link href="../qmd/multivar-factor.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-c8ad9e5dbd60b7b70b38521ab19b7da4.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-d3c9390091c69a50683db05bc45f20d8.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "일치 없음",
    "search-matching-documents-text": "일치된 문서",
    "search-copy-link-title": "검색 링크 복사",
    "search-hide-matches-text": "추가 검색 결과 숨기기",
    "search-more-match-text": "추가 검색결과",
    "search-more-matches-text": "추가 검색결과",
    "search-clear-button-title": "제거",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "취소",
    "search-submit-button-title": "검색",
    "search-label": "검색"
  }
}</script>
<script type="text/javascript">
 window.MathJax = {
  tex: {
    macros: {
    RR: '{\\mathbb R}',                    // a simple string replacement
    hatmat:'{\\pmb X ({\\pmb X}^t {\\pmb X} )^{-1} {\\pmb X}^t}',
    bold: ['\\boldsymbol{#1}',1] ,     // this macro has one parameter
    pardiff: ['\\frac{\\partial#2}{\\partial#1}', 2, 'x'], // this macro has an optional parameter that defaults to 'x'
    pardifftwo: ['\\frac{\\partial#1}{\\partial#2}', 2],
    pardiffd: ['\\frac{\\partial#1}{\\partial#2^t \\partial#2}', 2],
    pardiffdd: ['\\frac{\\partial#1}{\\partial#3 \\partial#2}', 3],
    norm: ['\\lVert#1\\rVert',1]
  },
  environments: {
  braced: ["\\left\\{", "\\right\\}"]
  }
 }
};
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="사이드바 전환" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../qmd/multivar-cluster.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">군집 분석</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="사이드바 전환" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="검색" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">다변량통계학-2025년 2학기</a> 
        <div class="sidebar-tools-main">
    <a href="../다변량통계학-2025년-2학기.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="검색"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/multivar-dist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">확률벡터와 다변량 정규분포</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/multivar-vis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">다변량 자료의 시각화</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/multivar-test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">다변량 가설 검정</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/multivar-cov.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">공분산 행렬의 추정</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/multivar-discrim.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">판별분석</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/multivar-pca.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">주성분 분석</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/multivar-cancor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">정준상관분석</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/multivar-factor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">탐색적 인자 분석</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/multivar-cluster.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">군집 분석</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/multivar-anova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">다변량 분산분석</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/math_mat_basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">행렬의 기초</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/math_eigen_value.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">고유값과 고유벡터</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/math_matrix_decomp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">행렬의 분해</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/app-likelihood-ratio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">가능도비 검정</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">목차</h2>
   
  <ul>
  <li><a href="#거리의-정의와-성질" id="toc-거리의-정의와-성질" class="nav-link active" data-scroll-target="#거리의-정의와-성질"><span class="header-section-number">9.1</span> 거리의 정의와 성질</a>
  <ul class="collapse">
  <li><a href="#연속형-변수" id="toc-연속형-변수" class="nav-link" data-scroll-target="#연속형-변수"><span class="header-section-number">9.1.1</span> 연속형 변수</a></li>
  <li><a href="#이항-변수" id="toc-이항-변수" class="nav-link" data-scroll-target="#이항-변수"><span class="header-section-number">9.1.2</span> 이항 변수</a></li>
  </ul></li>
  <li><a href="#계층적-군집-분석" id="toc-계층적-군집-분석" class="nav-link" data-scroll-target="#계층적-군집-분석"><span class="header-section-number">9.2</span> 계층적 군집 분석</a>
  <ul class="collapse">
  <li><a href="#최단-연결법" id="toc-최단-연결법" class="nav-link" data-scroll-target="#최단-연결법"><span class="header-section-number">9.2.1</span> 최단 연결법</a></li>
  <li><a href="#최장-연결법" id="toc-최장-연결법" class="nav-link" data-scroll-target="#최장-연결법"><span class="header-section-number">9.2.2</span> 최장 연결법</a></li>
  <li><a href="#평균연결법" id="toc-평균연결법" class="nav-link" data-scroll-target="#평균연결법"><span class="header-section-number">9.2.3</span> 평균연결법</a></li>
  <li><a href="#와드-방법" id="toc-와드-방법" class="nav-link" data-scroll-target="#와드-방법"><span class="header-section-number">9.2.4</span> 와드 방법</a></li>
  <li><a href="#요약과-예제" id="toc-요약과-예제" class="nav-link" data-scroll-target="#요약과-예제"><span class="header-section-number">9.2.5</span> 요약과 예제</a></li>
  </ul></li>
  <li><a href="#k-평균-군집분석" id="toc-k-평균-군집분석" class="nav-link" data-scroll-target="#k-평균-군집분석"><span class="header-section-number">9.3</span> K-평균 군집분석</a>
  <ul class="collapse">
  <li><a href="#예제-미국의-50개-주-범죄율-자료" id="toc-예제-미국의-50개-주-범죄율-자료" class="nav-link" data-scroll-target="#예제-미국의-50개-주-범죄율-자료"><span class="header-section-number">9.3.1</span> 예제: 미국의 50개 주 범죄율 자료</a></li>
  <li><a href="#예제로마-브리튼-도자기-군집화" id="toc-예제로마-브리튼-도자기-군집화" class="nav-link" data-scroll-target="#예제로마-브리튼-도자기-군집화"><span class="header-section-number">9.3.2</span> 예제:로마-브리튼 도자기 군집화</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content column-page-right" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">군집 분석</span></h1>
</div>



<div class="quarto-title-meta column-page-right">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pheatmap)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">#아래 3 문장은 한글을 포함한 ggplot 그림이 포함된 HTML, PDF로 만드는 경우 사용</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(showtext)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">#font_add_google("Nanum Pen Script", "gl")</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">font_add_google</span>(<span class="at">name =</span> <span class="st">"Noto Sans KR"</span>, <span class="at">family =</span> <span class="st">"noto"</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">showtext_auto</span>()</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>군집 분석(clustering)은 다변량 관측값들 사이의 유사성(또는 거리)을 기반으로 관측값들을 그룹화하는 방법이다. 군집분석은 다음과 같은 특징을 가진다.</p>
<ul>
<li>군집의 개수나 각 대상의 소속 집단에 대해 사전 가정을 두지 않는다.</li>
<li>각 군집의 형태나 구조에 대한 가정도 필요하지 않다.</li>
<li>비지도학습(unsupervised learning) 방법으로, 교사의 역활이 없는 상태에서 스스로 학습한다.</li>
<li>여러 변수들의 값을 이용하여 대상들을 유사한 특성을 가진 집단으로 분류하는 알고리즘을 구성한다.</li>
<li>유사한 특성을 가진 개체들은 동일한 군집에 포함된다.</li>
<li>개체 간의 유사성 또는 차이를 판단하기 위해 거리(distance) 또는 유사도(similarity)의 개념을 사용한다.</li>
</ul>
<p>군집분석은 계층적 군집분석(hierarchical clustering)과 비계층적 군집분석(non-hierarchical clustering)으로 나뉘며 두 방법에 대한 차이는 다음과 같다.</p>
<ul>
<li><p>계층적 군집분석</p>
<ul>
<li>군집 간의 포함 관계를 단계적으로 형성해 나가는 방법이다.</li>
<li>처음에는 각 개체를 하나의 군집으로 두고, 가까운 군집끼리 차례로 병합(병합적 방법)하거나, 반대로 전체를 하나의 군집으로 두고 점차 분할(분할적 방법)하는 방식으로 진행된다.</li>
<li>사전에 군집의 개수를 정할 필요가 없지만, 해석 단계에서 적절한 군집 수를 선택해야 한다.</li>
</ul></li>
<li><p>비계층적 군집분석</p>
<ul>
<li>군집의 개수를 미리 정해두고, 개체들을 그 개수만큼의 군집에 나누는 방법이다.</li>
<li>대표적인 예로 K-평균(K-means) 군집분석이 있다.</li>
<li>초기 군집 중심을 정한 뒤, 개체들을 가장 가까운 중심에 배정하고, 군집 중심을 다시 계산하는 과정을 반복(iteration)하면서 군집을 안정화시킨다.</li>
<li>대규모 자료에 적합하지만, 초기 설정(군집 수, 중심점)에 따라 결과가 달라질 수 있다.</li>
</ul></li>
</ul>
<p>먼저 군집 분석에 사용할 수 있는 다양한 거리의 정의와 성질에 대해 알아보고, 이후에 계층적 군집 분석과 비계층적 군집 분석 방법을 살펴본다.</p>
<section id="거리의-정의와-성질" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="거리의-정의와-성질"><span class="header-section-number">9.1</span> 거리의 정의와 성질</h2>
<section id="연속형-변수" class="level3" data-number="9.1.1">
<h3 data-number="9.1.1" class="anchored" data-anchor-id="연속형-변수"><span class="header-section-number">9.1.1</span> 연속형 변수</h3>
<p>우리는 세상을 수많은 요소를 통해 관찰한다. 사람을 구분할 때 외모, 언어, 문화, 지리적 배경 같은 요인이 서로 다른 차이를 만들어낸다. 한국인과 일본인은 서로 가까워 보이지만, 아프리카인과는 그 차이가 훨씬 크다고 느낀다. 이런 차이의 크기를 수학적으로 정의한 것이 바로 <strong>거리(distance)</strong>다. 이번 절에서는 다변량 변수를 다루는 경우 개별 관측값들 사이의 거리를 어떻게 정의할 수 있는지 다양한 거리의 정의와 성질을 알아본다.</p>
<p>먼저 p-차원 확률 벡터 <span class="math inline">\(\pmb X\)</span> 를 생각하고 <span class="math inline">\(n\)</span> 개의 관측벡터가 있다고 가정하자.</p>
<p><span class="math display">\[ \pmb X_1, \pmb X_2, \ldots, \pmb X_n \]</span> 여기서 <span class="math inline">\(\pmb X_i^t = (X_{i1}, X_{i2}, \dots, X_{ip})\)</span> 이다.</p>
<p><strong>유클리디안 거리 (Euclidean distance)</strong>는 우리가 일상에서 사용하는 거리 개념과 같다. <span class="math inline">\(p\)</span>-차원 공간에서 두 관측 벡터 <span class="math inline">\(\pmb X_1\)</span> 과 <span class="math inline">\(\pmb X_2\)</span> 사이의 유클리디안 거리는 다음과 같이 정의된다.</p>
<p><span class="math display">\[
d(\pmb X_1, \pmb X_2) = \sqrt{ (\pmb X_1 - \pmb X_2)^t (\pmb X_1 - \pmb X_2) } = \sqrt{\sum_{k=1}^p (X_{1k} - X_{2k})^2}
\]</span></p>
<p>유클리디안 거리는 실수 공간상의 거리이므로 다변량 변수들이 연속인 경우에 적용되는 거리이다.</p>
<p>유클리드 거리는 확률 변수들 간의 상관관계나 분산의 차이(불확실성의 차이)를 고려하지 않는다. 예를 들어, 두 변수들이 서로 다른 분산를 가진다면, 두 변수의 관측값을 이용한 거리가 같더라도 확률적 불확실성이 다를 수 있다.</p>
<p>예를 들어 두 확률 변수의 분산이 각각 1 과 10 이라고 한다면 두 개의 관측값에 의한 계산된 유클리디안 거리, 즉 대수적인 차이가 같더라고 차이에에 대한 확률적인 불확실성은 다르다.</p>
<p>유클리디안 거리를 확률적으로 보완하기 위해 통계학에서는 <strong>통계적 거리(statistical distance)</strong> 또는 <strong>마할라노비스 거리(Mahalanobis distance)</strong> 개념을 도입한다. 통계적 거리는 변수들 간의 상관관계와 분산을 고려하여 거리를 계산한다. 만약 확률벡터 <span class="math inline">\(\pmb X\)</span> 의 공분산 행렬을 <span class="math inline">\(\pmb V\)</span> 라고 하면 두 관측 벡터 <span class="math inline">\(\pmb X_1\)</span> 과 <span class="math inline">\(\pmb X_2\)</span> 사이의 통계적 거리는 다음과 같이 정의된다.</p>
<p><span class="math display">\[
d_M(\pmb X_1, \pmb X_2) = \sqrt{ (\pmb X_1 - \pmb X_2)^t \pmb V^{-1} (\pmb X_1 - \pmb X_2) }
\]</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
표준화
</div>
</div>
<div class="callout-body-container callout-body">
<p>유클리디안 거리는 측정값의 단위(scale)에 따라서 달라진다. 예를 들어, 어떤 사람의 키(cm)와 치아의 길이(mm)를 측정했다고 하자. 키의 변동폭은 20~30mm, 치아 길이의 변동폭은 1~2mm 정도다. 이때 단순히 두 변수의 차이를 이용하면, 거리는 대부분 키의 차이에 의해 좌우된다. 그래서 모든 변수가 거리 계산에 비슷한 영향을 주도록 하기 위해서 <strong>표준화(standardization)</strong>가 필요하다. 표준화는 각 변수에서 평군값을 뺴고 그 표준편차로 나누는 작업이며 표준화된 변수의 평균은 0 이고 분산은 1 이다.</p>
<p><span class="math display">\[
Z_{ik} = \frac{X_{ik} - \bar{X}_k}{s_k}
\]</span></p>
<p>여기서 <span class="math inline">\(\bar X_k\)</span> 는 <span class="math inline">\(k\)</span>-번쨰 변수의 표본 평균이고 <span class="math inline">\(s_k\)</span> 는 표본 표준편차이다. 표준화된 변수를 이용하여 유클리디안 거리를 계산하면, 각 변수가 거리 계산에 동일한 영향을 미치게 된다.</p>
</div>
</div>
<p>거리의 기본 성질은 다음과 같다.</p>
<ol type="1">
<li>비음수성(Non-negativity): 모든 관측값 쌍에 대하여 거리는 0 이상이다.</li>
</ol>
<p><span class="math display">\[
d(\pmb X_i, \pmb X_j) \geq 0
\]</span></p>
<ol start="2" type="1">
<li>대칭성(Symmetry): 두 관측값 사이의 거리는 순서에 상관없이 같다.</li>
</ol>
<p><span class="math display">\[
d(\pmb X_i, \pmb X_j) = d(\pmb X_j, \pmb X_i)
\]</span></p>
<ol start="3" type="1">
<li>삼각 부등식(Triangle inequality): 세 관측값 <span class="math inline">\(\pmb X_i\)</span>, <span class="math inline">\(\pmb X_j\)</span>, <span class="math inline">\(\pmb X_k\)</span>에 대하여 다음을 만족한다.</li>
</ol>
<p><span class="math display">\[
d(\pmb X_i, \pmb X_k) \leq d(\pmb X_i, \pmb X_j) + d(\pmb X_j, \pmb X_k)
\]</span></p>
</section>
<section id="이항-변수" class="level3" data-number="9.1.2">
<h3 data-number="9.1.2" class="anchored" data-anchor-id="이항-변수"><span class="header-section-number">9.1.2</span> 이항 변수</h3>
<p>이항 변수(binary variable)는 두 가지 값(예: 0과 1 또느 성걸과 실패)만을 가질 수 있는 변수이다. 예를 들어, 성별(남성/여성), 흡연 여부(흡연자/비흡연자) 등이 이항 변수에 해당한다. 이항 변수로 구성된 다변량 데이터에서 거리 계산을 할 때는 앞에서 살펴보 유클리디안 거리와 다른 거리의 개념을 적용할 필요가 있다.</p>
<p>에를 들어 마케팅 조사에서 고객 성향을 분석하기 위하여 10개의 항목에 대한 선호도 조사를 한다고 하자. 각 항목을 좋아하면 1, 좋아하지 않으면 0 이라고 하자. 아래 표에 2 명에 대한 조사결과가 있다면 10 개의 선호도 항목에 대한 자료로 두 사람이 얼마나 가까운지 어떻게 거리를 계산할 수 있을까? 참고로 아래와 같은 자료의 형식은 출현–부재 자료 (present-absence data)라고 부른다.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>항목</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>10</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>사람 1 (<span class="math inline">\(\pmb X_1\)</span>)</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td>사람 2 (<span class="math inline">\(\pmb X_2\)</span>)</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>위의 선호도 조사에서 얻은 자료를 다음과 같은 교차표로 정리할 수 있다.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th>사람 1 -좋아함</th>
<th>사람 1 싫어함</th>
<th>합계</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>사람 2 좋아함</td>
<td>a (3)</td>
<td>b (3)</td>
<td>a+b (6)</td>
</tr>
<tr class="even">
<td>사람 2 싫어함</td>
<td>c (3)</td>
<td>d (1)</td>
<td>c+d (4)</td>
</tr>
<tr class="odd">
<td>합계</td>
<td>a+c (6)</td>
<td>b+d (4)</td>
<td>n (10)</td>
</tr>
</tbody>
</table>
<p>여기서,</p>
<ul>
<li><span class="math inline">\(a\)</span>: 두 사람 모두 좋아하는 항목의 수</li>
<li><span class="math inline">\(b\)</span>: 사람 2는 좋아하지만 사람 1은 싫어하는 항목의 수</li>
<li><span class="math inline">\(c\)</span>: 사람 1은 좋아하지만 사람 2는 싫어하는 항목의 수</li>
<li><span class="math inline">\(d\)</span>: 두 사람 모두 싫어하는 항목의 수</li>
<li><span class="math inline">\(n\)</span>: 전체 항목의 수 (<span class="math inline">\(n = a + b + c + d\)</span>)</li>
</ul>
<p>이항 변수를 포함한 다변량 데이터에서 거리 계산을 위해 다음과 같은 거리 척도들이 사용된다.</p>
<ol type="1">
<li>단순 유사도 지표(simple matching index) : 전체 항목의 개수 중에서 이항변수의 관측값이 동일한 비율로 계산한다.</li>
</ol>
<p><span class="math display">\[
d(\pmb X_1, \pmb X_2) = \frac{a + d }{n}
\]</span></p>
<ol start="2" type="1">
<li>자카드 거리(Jaccard distance): 두 관측값이 모두 좋아하는 항목의 수에 대한 비율로 계산된다. 자카드 거리는 출현-부재 자료에서 서로에게 공통으로 존재하지 않는 항목이 반드시 두 개체의 유사성을 반영할 지 못 할 수 있는 경우를 고려한 거리이다. 예를 들어 두 사람이 모두 축구를 좋아할 경우와 모두 싫어할 경우 유사도가 다를 수 있다. 즉, 축구를 모두 좋아한다면 두 사람이 가깝다고 판단할 수 있지만 둘 다 싫어하는 경우 반드시 두 사람이 가깝지 않을 수 있다.</li>
</ol>
<p><span class="math display">\[
d(\pmb X_1, \pmb X_2) = \frac{a}{a + b + c}
\]</span></p>
<ol start="3" type="1">
<li>다이스 거리(Dice distance): 자카드 거리와 유사하지만, 공통으로 좋아하는 항목의 수에 2를 곱하여 계산된다. 서로 동시에 존재하는 항목의 중요성을 강조한 거리이다.</li>
</ol>
<p><span class="math display">\[
d(\pmb X_1, \pmb X_2) = \frac{2a}{2a + b + c}
\]</span></p>
<ol start="4" type="1">
<li>오치아이 거리(Ochiai distance): 두 관측값이 모두 좋아하는 항목의 수를 두 관측값이 좋아하는 항목의 수를 <span class="math inline">\((a+b)(a+c)\)</span>의 제곱근으로 나누어 계산된 거리이다. 오치아이 거리는 생태학에서 종간 공동으로 출현하는 유사도, 정보검색의 관점에서 보는 유사한 정도을 거리형식으로 측정할 때 자주 사용하는 거리이다.</li>
</ol>
<p><span class="math display">\[
d(\pmb X_1, \pmb X_2) = \frac{a}{\sqrt{(a+b)(a+c)}}
\]</span></p>
<p>이항변수로 이루어진 다변량 자료에 대한 거리는 단순히 수학적 계산으로 표현되는 추상적 개념이 아니다. 이는 복잡한 현실을 수량적으로 비교하고 이해하기 위한 하나의 언어적 체계로서 기능한다. 서로 다른 사람, 집단, 생태계, 혹은 시장과 같은 다양한 대상들은 이러한 거리 개념을 통해 하나의 공통된 축 위에서 비교되고 분석될 수 있다.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
주의
</div>
</div>
<div class="callout-body-container callout-body">
<p>이항변수로 이루어진 출현-부재 자료에서 정의된 거리는 공간상에서 정의된 거리의 성질을 만족하지 않을 수 있디.</p>
</div>
</div>
</section>
</section>
<section id="계층적-군집-분석" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="계층적-군집-분석"><span class="header-section-number">9.2</span> 계층적 군집 분석</h2>
<p>계층적 군집 분석은 방법은 데이터 내에 존재하는 자연스러운 군집 구조를 발견하는 데 유용하다. 계층적 군집 분석은 크게 두 가지 접근법으로 나눌 수 있다: 병합적 접근법(agglomerative approach)과 분할적 접근법(divisive approach)이다.</p>
<p>이 중 병합적 방법은 가장 널리 사용되는 형태로, 각 개체를 하나의 군집으로 시작하여 점차 유사한 군집끼리 결합해 가는 방식이다. 군집 간 거리를 계산하고, 가장 가까운 군집들을 반복적으로 병합한다. 결과는 덴드로그램(dendrogram)이라는 나무 모양의 그래프로 표현되어, 군집 간 결합 구조와 거리 수준을 시각적으로 보여준다.</p>
<p>먼저 거리 행렬의 예를 살펴보자. 5개의 개체들에 대하여 각각의 개체들 사이에 모든 거리가 존재하면 다음과 같은 거리 행렬(distance matrix)를 만들 수 있다.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-multivar-cluster-01" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-multivar-cluster-01-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../images/cluster-01.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="448">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-multivar-cluster-01-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;9.1: 거리 행렬
</figcaption>
</figure>
</div>
</div>
</div>
<p>여기서 주의할 점은 거리 행렬은 대칭행렬(symmetric matrix)이며, 거리는 주어진 상황에 따라서 적절한 거리 계산 방법을 선택하여 계산한다.</p>
<p>주어진 거리행렬에 대하여 병합적 계층적 군집화 알고리즘의 기본 절차는 다음과 같다.</p>
<ol type="1">
<li><p><strong>초기화</strong></p>
<ul>
<li><span class="math inline">\(N\)</span> 개의 개체(observation)를 하나의 독립된 군집으로 둔다.</li>
<li>초기 상태에서 군집의 수는 개체의 수와 동일하다.</li>
</ul></li>
<li><p><strong>거리 행렬 계산</strong></p>
<ul>
<li>모든 개체(또는 군집) 간의 거리 또는 유사도를 계산한다.</li>
<li>거리 행렬의 차원은 <span class="math inline">\(N \times N\)</span> 이다.</li>
<li><span class="math inline">\(i\)</span>번째 개체와 <span class="math inline">\(j\)</span>번째 개체 사이의 거리를 <span class="math inline">\(d_{ij}\)</span>로 표기한다.</li>
</ul></li>
<li><p><strong>가장 가까운 두 군집 선택</strong></p>
<ul>
<li>거리 행렬 <span class="math inline">\(\pmb D = \{ d_{ij} \}\)</span> 에서 가장 거리가 작은 두 군집을 찾는다.</li>
</ul></li>
<li><p><strong>군집 병합</strong></p>
<ul>
<li>선택된 두 군집을 하나의 군집으로 합친다.</li>
<li>전체 군집의 수는 한 단계 줄어든다.</li>
</ul></li>
<li><p><strong>거리 행렬 갱신</strong> (Update Distance Matrix)</p>
<ul>
<li>새로 형성된 군집과 나머지 군집들 간의 거리를 다시 계산한다.</li>
<li>이때 군집 간 거리를 정의하는 방식에 따라 다양한 방법이 존재한다</li>
</ul></li>
<li><p><strong>반복</strong> (Iterate)</p>
<ul>
<li>위의 과정을 군집의 수가 1이 될 때까지 반복한다.</li>
</ul></li>
</ol>
<p>새로운 군집을 형성할 때, 군집 간에 거리를 계산 방식을 연결 방법(Linkage Methods)이라고 하며 여러 가지가 있다.</p>
<p>이제 3 개의 군집 <span class="math inline">\(u, v, w\)</span> 가 있다고 하자. 군집 <span class="math inline">\(u\)</span> 와 <span class="math inline">\(v\)</span> 를 병합하여 새로운 군집 <span class="math inline">\([uv]\)</span> 를 형성할 때, 새로운 군집 <span class="math inline">\([uv]\)</span> 와 다른 군집 <span class="math inline">\(w\)</span> 사이의 거리를 계산하는 방법은 다음과 같다.</p>
<ul>
<li>최단연결법 (Single linkage): 두 군집 사이의 최소 거리로 정의된다.</li>
</ul>
<p><span class="math display">\[ d([uv], w) = \min(d(u, w), d(v, w)) \]</span></p>
<ul>
<li>최장연결법 (Complete linkage): 두 군집 사이의 최대 거리로 정의된다.</li>
</ul>
<p><span class="math display">\[ d([uv], w) = \max(d(u, w), d(v, w)) \]</span></p>
<ul>
<li>평균연결법 (Average linkage): 두 군집 내 모든 쌍의 평균 거리로 정의된다.</li>
</ul>
<p><span class="math display">\[ d([uv], w) = \frac{\sum_m \sum_n d(m,n)} { N_{[uv]} N_w} \]</span> 위의 식에서 <span class="math inline">\(m\)</span>은 군집 <span class="math inline">\([uv]\)</span>에 속한 개체, <span class="math inline">\(n\)</span>은 군집 <span class="math inline">\(w\)</span>에 속한 개체를 나타내며, <span class="math inline">\(N_{[uv]}\)</span>와 <span class="math inline">\(N_w\)</span>는 각각 군집 <span class="math inline">\([uv]\)</span>와 군집 <span class="math inline">\(w\)</span>에 속한 개체의 수이다.</p>
<p>이제 <a href="#fig-multivar-cluster-01" class="quarto-xref">그림&nbsp;<span>9.1</span></a> 에 제시된 거리 행렬을 이용하여 계층적 군집 분석을 수행하는 과정을 위에서 제시한 3 가지 방법으로 살펴보자.</p>
<section id="최단-연결법" class="level3" data-number="9.2.1">
<h3 data-number="9.2.1" class="anchored" data-anchor-id="최단-연결법"><span class="header-section-number">9.2.1</span> 최단 연결법</h3>
<p>먼저 <a href="#fig-multivar-cluster-01" class="quarto-xref">그림&nbsp;<span>9.1</span></a> 에 제시된 거리 행렬에서 가장 작은 거리를 찾는다. 이 경우, 개체 3과 개체 5 사이의 거리가 2 로 가장 작다. 따라서 개체 3과 개체 5를 병합하여 새로운 군집 [3,5]를 형성한다.</p>
<p>다음으로, 새로운 군집 [3,5]와 나머지 개체들(1, 2, 4) 사이의 거리를 계산한다. 최단연결법을 사용하므로, 군집 [3,5]와 개체 1 사이의 거리는 다음과 같이 계산된다.</p>
<p><span class="math display">\[
d([3,5], 1) = \min(d(3, 1), d(5, 1)) = \min(3, 11) = 3
\]</span> 또한, 군집 [3,5]와 개체 2 사이의 거리는 다음과 같이 계산된다.</p>
<p><span class="math display">\[
d([3,5], 2) = \min(d(3, 2), d(5, 2)) = \min(7, 10) = 7
\]</span> 이제 갱신된 거리 행렬은 다음과 같다.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-multivar-cluster-02" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-multivar-cluster-02-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../images/cluster-02.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="304">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-multivar-cluster-02-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;9.2: 최단 연결법 1차 작업에 의하여 갱신된 거리행렬
</figcaption>
</figure>
</div>
</div>
</div>
<p>이제 <a href="#fig-multivar-cluster-02" class="quarto-xref">그림&nbsp;<span>9.2</span></a> 에 의한 거리 행렬에서 가장 작은 거리를 보이는 군집 <span class="math inline">\([3,5]\)</span> 와 군집 <span class="math inline">\(1\)</span> 을 통합하고 다시 거리를 계산한다. 예를 들어 통합된 군집 <span class="math inline">\([1,3,5]\)</span> 와 군집 <span class="math inline">\(2\)</span> 의 거리는 다음과 같이 계산된다.</p>
<p><span class="math display">\[
d([1,3,5], 2) = \min(d([3,5], 2), d(1, 2)) = \min(7,9)) = 7
\]</span></p>
<p>또한 통합된 군집 <span class="math inline">\([1,3,5]\)</span> 와 군집 <span class="math inline">\(4\)</span> 의 거리는 다음과 같이 계산된다.</p>
<p><span class="math display">\[
d([1,3,5], 4) = \min(d([3,5], 4), d(1, 4)) = \min(8,6) = 6
\]</span></p>
<p>이제 다시 갱신된 거리 행렬은 다음과 같다.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-multivar-cluster-03" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-multivar-cluster-03-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../images/cluster-03.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="304">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-multivar-cluster-03-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;9.3: 최단 연결법 2차 작업에 의하여 갱신된 거리행렬
</figcaption>
</figure>
</div>
</div>
</div>
<p>다음으로 <a href="#fig-multivar-cluster-03" class="quarto-xref">그림&nbsp;<span>9.3</span></a> 에 제시된 거리행렬에서 가장 작은 거리를 가진 군집 2 와 군집 4 를 병합한다. 이제 군집 <span class="math inline">\([1,3,5]\)</span> 와 군집 <span class="math inline">\([2,4]\)</span> 의 거리는 다음과 같이 계산할 수 있다.</p>
<p><span class="math display">\[
d([1,3,5], [2,4]) = \min(d([1,3,5], 2), d([1,3,5], 4)) = \min(7,6) = 6
\]</span></p>
<p>이제 최종 갱신된 거리 행렬은 다음과 같다.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-multivar-cluster-04" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-multivar-cluster-04-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../images/cluster-04.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="304">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-multivar-cluster-04-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;9.4: 최단 연결법 3차 작업에 의하여 갱신된 거리행렬
</figcaption>
</figure>
</div>
</div>
</div>
<p>이제 2 개의 군집만 존재하므로 두 개를 병합하면 최종적으로 모든 개체를 하나의 군집으로 병합된다.</p>
</section>
<section id="최장-연결법" class="level3" data-number="9.2.2">
<h3 data-number="9.2.2" class="anchored" data-anchor-id="최장-연결법"><span class="header-section-number">9.2.2</span> 최장 연결법</h3>
<p>최장 연결법(Complete linkage)은 두 군집 사이의 최대 거리를 기준으로 군집 간 거리를 정의하는 방법이다. 이 방법은 군집 내의 모든 개체들이 서로 가까워지도록 하는 경향이 있다.</p>
<p>최장 연결법을 사용하여 <a href="#fig-multivar-cluster-01" class="quarto-xref">그림&nbsp;<span>9.1</span></a> 에 제시된 거리 행렬을 이용하여 계층적 군집 분석을 수행하는 과정을 살펴보자.</p>
<p>먼저 거리 행렬에서 가장 작은 거리를 찾는다. 이 경우, 개체 3과 개체 5 사이의 거리가 2로 가장 작다. 따라서 개체 3과 개체 5를 병합하여 새로운 군집 [3,5]를 형성한다.</p>
<p>다음으로, 새로운 군집 [3,5]와 나머지 개체들(1, 2, 4) 사이의 거리를 계산한다.최장 연결법을 사용하므로, 군집 [3,5]와 개체 1 사이의 거리는 다음과 같이 계산된다.</p>
<p><span class="math display">\[
d([3,5], 1) = \max(d(3, 1), d(5, 1)) = \max(3, 11) = 11
\]</span> 또한, 군집 [3,5]와 개체 2 사이의 거리는 다음과 같이 계산된다.</p>
<p><span class="math display">\[
d([3,5], 2) = \max(d(3, 2), d(5, 2)) = \max(7, 10) = 10
\]</span> 이제 갱신된 거리 행렬은 다음과 같다.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-multivar-cluster-05" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-multivar-cluster-05-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../images/cluster-05.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="304">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-multivar-cluster-05-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;9.5: 최장 연결법 1차 작업에 의하여 갱신된 거리행렬
</figcaption>
</figure>
</div>
</div>
</div>
<p>다음으로 <a href="#fig-multivar-cluster-05" class="quarto-xref">그림&nbsp;<span>9.5</span></a> 에 의한 거리행렬에서 가장 작은 거리를 보이는 군집 2 와 군집 4 을 통합하고 다시 거리를 계산한다. 예를 들어 통합된 군집 <span class="math inline">\([3,5]\)</span> 와 군집 <span class="math inline">\([2,4]\)</span> 의 거리는 다음과 같이 계산된다.</p>
<p><span class="math display">\[
d([2,4],[3,5]) = \max(d(2,[3,5]), d(4,[3,5])) = \max(10,9)) = 10
\]</span></p>
<p>또한 군집 <span class="math inline">\([2,4]\)</span> 와 군집 1 의 거리는 다음과 같다.</p>
<p><span class="math display">\[
d([2,4],1) = \max(d(2,1), d(4,1)) = \max(9,6)) = 9
\]</span></p>
<p>이제 모든 거리를 갱신하면 다음과 같은 거리행렬을 얻는다.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-multivar-cluster-06" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-multivar-cluster-06-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../images/cluster-06.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="276">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-multivar-cluster-06-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;9.6: 최장 연결법 2차 작업에 의하여 갱신된 거리행렬
</figcaption>
</figure>
</div>
</div>
</div>
<p>다음으로 <a href="#fig-multivar-cluster-06" class="quarto-xref">그림&nbsp;<span>9.6</span></a> 에 제시된 거리행렬에서 가장 작은 거리를 보이는 군집 <span class="math inline">\([2,4]\)</span> 와 군집 1 을 병합한다. 이제 군집 <span class="math inline">\([1,2,4]\)</span> 와 군집 <span class="math inline">\([3,5]\)</span> 의 거리는 다음과 같이 계산할 수 있다.</p>
<p><span class="math display">\[
d([1,2,4], [3,5]) = \max(d(1,[3,5]), d([2,4],[3,5])) = \max(11,10) = 11
\]</span></p>
<p>이제 최종 갱신된 거리 행렬은 다음과 같다.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-multivar-cluster-07" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-multivar-cluster-07-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../images/cluster-07.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="276">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-multivar-cluster-07-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;9.7: 최장 연결법 3차 작업에 의하여 갱신된 거리행렬
</figcaption>
</figure>
</div>
</div>
</div>
<p>마지막으로 군집 <span class="math inline">\([1,2,4]\)</span> 와 <span class="math inline">\([3,5]\)</span> 를 통합하면 된다.</p>
</section>
<section id="평균연결법" class="level3" data-number="9.2.3">
<h3 data-number="9.2.3" class="anchored" data-anchor-id="평균연결법"><span class="header-section-number">9.2.3</span> 평균연결법</h3>
<p>마지막으로 평균연결법(Average linkage)은 두 군집 내 모든 쌍의 평균 거리로 군집 간 거리를 정의하는 방법이다. 이 방법은 군집 내의 개체들 간의 거리를 균형 있게 반영하여 군집을 형성하는 경향이 있다.</p>
<p>먼저 <a href="#fig-multivar-cluster-01" class="quarto-xref">그림&nbsp;<span>9.1</span></a> 에 제시된 거리 행렬에서 가장 작은 거리를 찾는다. 이 경우, 개체 3과 개체 5 사이의 거리가 2 로 가장 작다. 따라서 개체 3과 개체 5를 병합하여 새로운 군집 [3,5]를 형성한다.</p>
<p>다음으로, 새로운 군집 [3,5]와 나머지 개체들(1, 2, 4) 사이의 거리를 계산한다. 평균 연결법을 사용하므로, 군집 [3,5]와 개체 1 사이의 거리는 다음과 같이 계산된다.</p>
<p><span class="math display">\[
d([3,5], 1) = mean(d(3, 1), d(5, 1)) = mean(3, 11) = \frac{3+11}{2} = 7
\]</span> 또한, 군집 [3,5]와 개체 2 사이의 거리는 다음과 같이 계산된다.</p>
<p><span class="math display">\[
d([3,5], 2) = mean(d(3, 2), d(5, 2)) = mean(7,10) = \frac{7+10}{2} = 8.5
\]</span> 이제 갱신된 거리 행렬은 다음과 같다.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-multivar-cluster-08" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-multivar-cluster-08-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../images/cluster-08.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="273">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-multivar-cluster-08-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
그림&nbsp;9.8: 평균 연결법 1차 작업에 의하여 갱신된 거리행렬
</figcaption>
</figure>
</div>
</div>
</div>
<p>이제 <a href="#fig-multivar-cluster-08" class="quarto-xref">그림&nbsp;<span>9.8</span></a> 에 의한 거리행렬에서 가장 작은 거리를 보이는 군집 2 와 군집 4을 통합하고 다시 거리를 계산한다. 예를 들어 통합된 군집 <span class="math inline">\([2,4]\)</span> 와 군집 <span class="math inline">\([3,5]\)</span> 의 거리는 다음과 같이 계산된다.</p>
<p><span class="math display">\[
d([2,4],[3,5]) = mean (d_{2,3}, d_{2,5}, d_{4,3}, d_{4,5}) = mean(7,10,8,9) = \frac{7+10+8+9}{4} = 8.5
\]</span></p>
<p>평균 연결법은 위와 같이 거리를 두 든 조합을 고려하여 평균으로 거리를 츠측정하는 방법으로 군집 간의 거리를 계산한다. 이 과정을 반복하여 최종적으로 모든 개체가 하나의 군집으로 통합될 때까지 진행한다.</p>
</section>
<section id="와드-방법" class="level3" data-number="9.2.4">
<h3 data-number="9.2.4" class="anchored" data-anchor-id="와드-방법"><span class="header-section-number">9.2.4</span> 와드 방법</h3>
<p>와드 방법(Ward’s method)는 가장 자주 사용되는 방법으로 군집 내 분산의 증가량을 최소화하는 방식으로 군집을 병합한다. 군집이 결합될 때 발생하는 군집 내 제곱합(Within-Cluster Sum of Squares)의 증가를 최소화하는 방향으로 군집을 합친다.</p>
</section>
<section id="요약과-예제" class="level3" data-number="9.2.5">
<h3 data-number="9.2.5" class="anchored" data-anchor-id="요약과-예제"><span class="header-section-number">9.2.5</span> 요약과 예제</h3>
<p>다음은 각 연결법의 방법과 특징을 요약한 표이다.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 37%">
<col style="width: 24%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th>방법</th>
<th>정의</th>
<th>특징</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>최단연결법</td>
<td>두 군집 사이의 최소 거리</td>
<td>긴 “사슬형(chain-like)” 군집 생성 가능</td>
</tr>
<tr class="even">
<td>최장연결법</td>
<td>두 군집 사이의 최대 거리</td>
<td>조밀하고 균일한 군집 형성</td>
</tr>
<tr class="odd">
<td>평균연결법</td>
<td>두 군집 내 모든 쌍의 평균 거리</td>
<td>균형 잡힌 결과, 이상치에 덜 민감</td>
</tr>
<tr class="even">
<td>와드 방법</td>
<td>군집 내 제곱합 증가량 최소화</td>
<td>분산 기반, 매우 안정적이고 자주 사용됨</td>
</tr>
</tbody>
</table>
<p>분할적 계층적 군집 방법(Divisive Hierarchical Methods)은 병합적 계층적 군집 방법(Agglomerative Hierarchical Methods)에 비해 상대적으로 덜 사용되어 왔다. 군집분석의 성능은 군집의 형태, 군집들이 서로 얼마나 겹쳐 있는가에 크게 의존한다.</p>
<ul>
<li>거리 행렬 만들기</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">7</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">9</span>,<span class="dv">2</span>,<span class="dv">8</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">5</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>k<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) {</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> ( j <span class="cf">in</span> (i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    dd[i,j] <span class="ot">=</span> x[k]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    dd[j,i] <span class="ot">=</span> x[k]</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    k<span class="ot">&lt;-</span>k<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  dd[i,i]<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">as.dist</span>(dd)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   1  2  3  4
2  9         
3  3  7      
4  6  5  9   
5 11 10  2  8</code></pre>
</div>
</div>
<ul>
<li>최단연결법</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>re1 <span class="ot">&lt;-</span> <span class="fu">hclust</span>(d, <span class="at">method=</span><span class="st">"single"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(re1)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-cluster_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>최장연결법</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>re2 <span class="ot">&lt;-</span> <span class="fu">hclust</span>(d, <span class="at">method=</span><span class="st">"complete"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(re2)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-cluster_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>평균연결법</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>re3 <span class="ot">&lt;-</span> <span class="fu">hclust</span>(d, <span class="at">method=</span><span class="st">"average"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(re3)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-cluster_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>와드 방법(Ward’s method)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>re4 <span class="ot">&lt;-</span> <span class="fu">hclust</span>(d, <span class="at">method=</span><span class="st">"ward.D2"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(re4)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-cluster_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="신체치수-자료" class="level4" data-number="9.2.5.1">
<h4 data-number="9.2.5.1" class="anchored" data-anchor-id="신체치수-자료"><span class="header-section-number">9.2.5.1</span> 신체치수 자료</h4>
<p>20명의 가슴, 허리, 엉덩이, 성별 측정 자료에 계층적 군집분석을 적용해 보자.</p>
<ol type="1">
<li>자료의 생성</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>measure <span class="ot">&lt;-</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">structure</span>(<span class="fu">list</span>(<span class="at">V1 =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="at">V2 =</span> <span class="fu">c</span>(<span class="dv">34</span>L, <span class="dv">37</span>L, <span class="dv">38</span>L, <span class="dv">36</span>L, <span class="dv">38</span>L, <span class="dv">43</span>L, </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="dv">40</span>L, <span class="dv">38</span>L, <span class="dv">40</span>L, <span class="dv">41</span>L, <span class="dv">36</span>L, <span class="dv">36</span>L, <span class="dv">34</span>L, <span class="dv">33</span>L, <span class="dv">36</span>L, <span class="dv">37</span>L, <span class="dv">34</span>L, <span class="dv">36</span>L, <span class="dv">38</span>L, </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="dv">35</span>L), <span class="at">V3 =</span> <span class="fu">c</span>(<span class="dv">30</span>L, <span class="dv">32</span>L, <span class="dv">30</span>L, <span class="dv">33</span>L, <span class="dv">29</span>L, <span class="dv">32</span>L, <span class="dv">33</span>L, <span class="dv">30</span>L, <span class="dv">30</span>L, <span class="dv">32</span>L, </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="dv">24</span>L, <span class="dv">25</span>L, <span class="dv">24</span>L, <span class="dv">22</span>L, <span class="dv">26</span>L, <span class="dv">26</span>L, <span class="dv">25</span>L, <span class="dv">26</span>L, <span class="dv">28</span>L, <span class="dv">23</span>L), <span class="at">V4 =</span> <span class="fu">c</span>(<span class="dv">32</span>L, </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="dv">37</span>L, <span class="dv">36</span>L, <span class="dv">39</span>L, <span class="dv">33</span>L, <span class="dv">38</span>L, <span class="dv">42</span>L, <span class="dv">40</span>L, <span class="dv">37</span>L, <span class="dv">39</span>L, <span class="dv">35</span>L, <span class="dv">37</span>L, <span class="dv">37</span>L, <span class="dv">34</span>L, </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="dv">38</span>L, <span class="dv">37</span>L, <span class="dv">38</span>L, <span class="dv">37</span>L, <span class="dv">40</span>L, <span class="dv">35</span>L)), <span class="at">.Names =</span> <span class="fu">c</span>(<span class="st">"V1"</span>, <span class="st">"V2"</span>, <span class="st">"V3"</span>, </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="st">"V4"</span>), <span class="at">class =</span> <span class="st">"data.frame"</span>, <span class="at">row.names =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="sc">-</span><span class="dv">20</span>L))</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>measure <span class="ot">&lt;-</span> measure[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(measure) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"chest"</span>, <span class="st">"waist"</span>, <span class="st">"hips"</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>measure<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">gl</span>(<span class="dv">2</span>, <span class="dv">10</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(measure<span class="sc">$</span>gender) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"male"</span>, <span class="st">"female"</span>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(measure)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  chest waist hips gender
1    34    30   32   male
2    37    32   37   male
3    38    30   36   male
4    36    33   39   male
5    38    29   33   male
6    43    32   38   male</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>거리행렬의 생성</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>dm <span class="ot">&lt;-</span> <span class="fu">dist</span>(measure[, <span class="fu">c</span>(<span class="st">"chest"</span>, <span class="st">"waist"</span>, <span class="st">"hips"</span>)])</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(dm, <span class="dv">2</span>)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1     2     3     4     5     6     7     8     9    10    11    12
2   6.16                                                                  
3   5.66  2.45                                                            
4   7.87  2.45  4.69                                                      
5   4.24  5.10  3.16  7.48                                                
6  11.00  6.08  5.74  7.14  7.68                                          
7  12.04  5.92  7.00  5.00 10.05  5.10                                    
8   8.94  3.74  4.00  3.74  7.07  5.74  4.12                              
9   7.81  3.61  2.24  5.39  4.58  3.74  5.83  3.61                        
10 10.10  4.47  4.69  5.10  7.35  2.24  3.32  3.74  3.00                  
11  7.00  8.31  6.40  9.85  5.74 11.05 12.08  8.06  7.48 10.25            
12  7.35  7.07  5.48  8.25  6.00  9.95 10.25  6.16  6.40  8.83  2.24      
13  7.81  8.54  7.28  9.43  7.55 12.08 11.92  7.81  8.49 10.82  2.83  2.24
14  8.31 11.18  9.64 12.45  8.66 14.70 15.30 11.18 11.05 13.75  3.74  5.20
15  7.48  6.16  4.90  7.07  6.16  9.22  9.00  4.90  5.74  7.87  3.61  1.41
16  7.07  6.00  4.24  7.35  5.10  8.54  9.11  5.10  5.00  7.48  3.00  1.41
17  7.81  7.68  6.71  8.31  7.55 11.40 10.77  6.71  7.87  9.95  3.74  2.24
18  6.71  6.08  4.58  7.28  5.39  9.27  9.49  5.39  5.66  8.06  2.83  1.00
19  9.17  5.10  4.47  5.48  7.07  6.71  5.74  2.00  4.12  5.10  6.71  4.69
20  7.68  9.43  7.68 10.82  7.00 12.41 13.19  9.11  8.83 11.53  1.41  3.00
      13    14    15    16    17    18    19
2                                           
3                                           
4                                           
5                                           
6                                           
7                                           
8                                           
9                                           
10                                          
11                                          
12                                          
13                                          
14  3.74                                    
15  3.00  6.40                              
16  3.61  6.40  1.41                        
17  1.41  5.10  2.24  3.32                  
18  2.83  5.83  1.00  1.00  2.45            
19  6.40  9.85  3.46  3.74  5.39  4.12      
20  2.45  2.45  4.36  4.12  3.74  3.74  7.68</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>최단연결법(single linkage)과 덴드로그램</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>re1 <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dm, <span class="at">method=</span><span class="st">"single"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(re1)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-cluster_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li>최장연결법(complete linkage)과 덴드로그램</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>re2 <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dm, <span class="at">method=</span><span class="st">"complete"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(re2)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-cluster_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="5" type="1">
<li>평균연결법(average linkage)과 덴드로그램</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>re3 <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dm, <span class="at">method=</span><span class="st">"average"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(re3)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-cluster_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="개의-군집으로-나누었을-때-그림들" class="level4" data-number="9.2.5.2">
<h4 data-number="9.2.5.2" class="anchored" data-anchor-id="개의-군집으로-나누었을-때-그림들"><span class="header-section-number">9.2.5.2</span> 2개의 군집으로 나누었을 때 그림들</h4>
<ul>
<li><p>자료가 남자10명, 여자 10영으로 구성되어있기 때문에 2개의 군집으로 나누어 진다고 예상</p></li>
<li><p>덴드로그램 높이(y축, 거리)의 변화를 보고 2개의 군집으로 나눌 수 있는 기준(cut point)를 결정</p></li>
<li><p>예를 들어 최단거리법에서는 cut point = 3.8</p></li>
<li><p>자료에 주성분 분석을 실시하여 첫 번째와 두 번째 주성분을 이용해 삼포도를 그리고 군집분석의 결과를 나타낸다 (1 과 2는 다른 군집)</p></li>
<li><p>최단거리법의 문제점: 연쇄현상(chaining)이 나타난다.</p></li>
<li><p>연쇄현상(chaining)은 두 개의 군집이 연결되어 있을 때 군집을 분리하지 못하는 현상</p></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-cluster_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>실제로 남자와 여자가 어떻게 배치되는지 보자.</li>
<li>최장연결법과 평균연결법은 남자와 여자를 잘 구분한다.</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-cluster_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="제트-전투기-군집화" class="level4" data-number="9.2.5.3">
<h4 data-number="9.2.5.3" class="anchored" data-anchor-id="제트-전투기-군집화"><span class="header-section-number">9.2.5.3</span> 제트 전투기 군집화</h4>
<ul>
<li>22개 미국 전투기에 대한 6개 변수</li>
</ul>
<p>다음은 22개 미국 전투기에 대한 6개 변수들이며 군집분석에는 두 번째부터 다섯번째까지 4개의 변수를 이용하며 최장연결법을 적용한다.</p>
<ul>
<li><code>FED</code>: 처음비행날짜</li>
<li><code>SPR</code>: 출력</li>
<li><code>RGF</code>: 비행범위 요인</li>
<li><code>PLF</code>: 탑재량</li>
<li><code>SLF</code>: 무게요인</li>
<li><code>CAR</code>: 항모착륙가능여부</li>
</ul>
<p>자료를 다음과 같이 만든다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>jet <span class="ot">&lt;-</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">structure</span>(<span class="fu">list</span>(<span class="at">V1 =</span> <span class="fu">c</span>(<span class="dv">82</span>L, <span class="dv">89</span>L, <span class="dv">101</span>L, <span class="dv">107</span>L, <span class="dv">115</span>L, <span class="dv">122</span>L, <span class="dv">127</span>L,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="dv">137</span>L, <span class="dv">147</span>L, <span class="dv">166</span>L, <span class="dv">174</span>L, <span class="dv">175</span>L, <span class="dv">177</span>L, <span class="dv">184</span>L, <span class="dv">187</span>L, <span class="dv">189</span>L, <span class="dv">194</span>L, <span class="dv">197</span>L,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="dv">201</span>L, <span class="dv">204</span>L, <span class="dv">255</span>L, <span class="dv">328</span>L), <span class="at">V2 =</span> <span class="fu">c</span>(<span class="fl">1.468</span>, <span class="fl">1.605</span>, <span class="fl">2.168</span>, <span class="fl">2.054</span>, <span class="fl">2.467</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fl">1.294</span>, <span class="fl">2.183</span>, <span class="fl">2.426</span>, <span class="fl">2.607</span>, <span class="fl">4.567</span>, <span class="fl">4.588</span>, <span class="fl">3.618</span>, <span class="fl">5.855</span>, <span class="fl">2.898</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fl">3.88</span>, <span class="fl">0.455</span>, <span class="fl">8.088</span>, <span class="fl">6.502</span>, <span class="fl">6.081</span>, <span class="fl">7.105</span>, <span class="fl">8.548</span>, <span class="fl">6.321</span>), <span class="at">V3 =</span> <span class="fu">c</span>(<span class="fl">3.3</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fl">3.64</span>, <span class="fl">4.87</span>, <span class="fl">4.72</span>, <span class="fl">4.11</span>, <span class="fl">3.75</span>, <span class="fl">3.97</span>, <span class="fl">4.65</span>, <span class="fl">3.84</span>, <span class="fl">4.92</span>, <span class="fl">3.82</span>, <span class="fl">4.32</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="fl">4.53</span>, <span class="fl">4.48</span>, <span class="fl">5.39</span>, <span class="fl">4.99</span>, <span class="fl">4.5</span>, <span class="fl">5.2</span>, <span class="fl">5.65</span>, <span class="fl">5.4</span>, <span class="fl">4.2</span>, <span class="fl">6.45</span>), <span class="at">V4 =</span> <span class="fu">c</span>(<span class="fl">0.166</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="fl">0.154</span>, <span class="fl">0.177</span>, <span class="fl">0.275</span>, <span class="fl">0.298</span>, <span class="fl">0.15</span>, <span class="dv">0</span>, <span class="fl">0.117</span>, <span class="fl">0.155</span>, <span class="fl">0.138</span>, <span class="fl">0.249</span>,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="fl">0.143</span>, <span class="fl">0.172</span>, <span class="fl">0.178</span>, <span class="fl">0.101</span>, <span class="fl">0.008</span>, <span class="fl">0.251</span>, <span class="fl">0.366</span>, <span class="fl">0.106</span>, <span class="fl">0.089</span>,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="fl">0.222</span>, <span class="fl">0.187</span>), <span class="at">V5 =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">2.9</span>, <span class="fl">1.1</span>, <span class="dv">1</span>, <span class="fl">0.9</span>, <span class="fl">2.4</span>, <span class="fl">1.8</span>, <span class="fl">2.3</span>,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="fl">3.2</span>, <span class="fl">3.5</span>, <span class="fl">2.8</span>, <span class="fl">2.5</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="fl">2.64</span>, <span class="fl">2.7</span>, <span class="fl">2.9</span>, <span class="fl">2.9</span>, <span class="fl">3.2</span>, <span class="fl">2.9</span>, <span class="dv">2</span>),</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">V6 =</span> <span class="fu">c</span>(<span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">1</span>L, <span class="dv">0</span>L, <span class="dv">1</span>L)), <span class="at">.Names =</span> <span class="fu">c</span>(<span class="st">"V1"</span>, <span class="st">"V2"</span>,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="st">"V3"</span>, <span class="st">"V4"</span>, <span class="st">"V5"</span>, <span class="st">"V6"</span>), <span class="at">class =</span> <span class="st">"data.frame"</span>, <span class="at">row.names =</span> <span class="fu">c</span>(<span class="cn">NA</span>,</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="dv">22</span>L))                                                   </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(jet) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"FFD"</span>, <span class="st">"SPR"</span>, <span class="st">"RGF"</span>, <span class="st">"PLF"</span>, <span class="st">"SLF"</span>, <span class="st">"CAR"</span>)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(jet) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"FH-1"</span>, <span class="st">"FJ-1"</span>, <span class="st">"F-86A"</span>, <span class="st">"F9F-2"</span>, <span class="st">"F-94A"</span>, <span class="st">"F3D-1"</span>, <span class="st">"F-89A"</span>,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"XF10F-1"</span>, <span class="st">"F9F-6"</span>, <span class="st">"F-100A"</span>, <span class="st">"F4D-1"</span>, <span class="st">"F11F-1"</span>,</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"F-101A"</span>, <span class="st">"F3H-2"</span>, <span class="st">"F-102A"</span>, <span class="st">"F-8A"</span>, <span class="st">"F-104B"</span>,</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"F-105B"</span>, <span class="st">"YF-107A"</span>, <span class="st">"F-106A"</span>, <span class="st">"F-4B"</span>, <span class="st">"F-111A"</span>)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>jet<span class="sc">$</span>CAR <span class="ot">&lt;-</span> <span class="fu">factor</span>(jet<span class="sc">$</span>CAR, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"no"</span>, <span class="st">"yes"</span>))</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(jet)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      FFD   SPR  RGF   PLF SLF CAR
FH-1   82 1.468 3.30 0.166 0.1  no
FJ-1   89 1.605 3.64 0.154 0.1  no
F-86A 101 2.168 4.87 0.177 2.9 yes
F9F-2 107 2.054 4.72 0.275 1.1  no
F-94A 115 2.467 4.11 0.298 1.0 yes
F3D-1 122 1.294 3.75 0.150 0.9  no</code></pre>
</div>
</div>
<ul>
<li>계층적 군집분석</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">scale</span>(jet[, <span class="fu">c</span>(<span class="st">"SPR"</span>, <span class="st">"RGF"</span>, <span class="st">"PLF"</span>, <span class="st">"SLF"</span>)],</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">center =</span> <span class="cn">FALSE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>) </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>dj <span class="ot">&lt;-</span> <span class="fu">dist</span>(X)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cc <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dj), <span class="at">main =</span> <span class="st">"Jets clustering"</span>)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-cluster_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>cc</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
hclust(d = dj)

Cluster method   : complete 
Distance         : euclidean 
Number of objects: 22 </code></pre>
</div>
</div>
<ul>
<li>2개의 주성분을 이용한 군집분석의 시각화</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>pr <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(dj)<span class="sc">$</span>x[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pr, <span class="at">pch =</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)[<span class="fu">cutree</span>(cc, <span class="at">k =</span> <span class="dv">2</span>)],</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"darkgrey"</span>)[jet<span class="sc">$</span>CAR], </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">range</span>(pr) <span class="sc">*</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">1.5</span>))</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"black"</span>, </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"darkgrey"</span>, <span class="st">"darkgrey"</span>), </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"1 / no"</span>, <span class="st">"2 / no"</span>, <span class="st">"1 / yes"</span>, <span class="st">"2 / yes"</span>), </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), <span class="at">title =</span> <span class="st">"Cluster / CAR"</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-cluster_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="k-평균-군집분석" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="k-평균-군집분석"><span class="header-section-number">9.3</span> K-평균 군집분석</h2>
<p>비계층적 군집 분석 방법 중에서 가장 널리 사용되는 방법은 K-평균(K-means) 군집 분석이다. K-평균 군집 분석은 주어진 개체들을 미리 정해진 군집의 개수 <span class="math inline">\(k\)</span> 로 구성된 군집 <span class="math inline">\(G_1, G_2, \dots, G_k\)</span> 으로 나누는 방법이다.</p>
<p>군집안에 속한 개체의 개수를 <span class="math inline">\(n_l\)</span> 라고 하자. 또한 각 군집의 중심(centroid)을 <span class="math inline">\(\pmb c_l\)</span> 라고 하자. 그러면 K-평균 군집 분석의 목적은 다음의 목적함수인 그룹내 제곱합(within-group sum of squares; WGSS)를 최소화하는 것이다.</p>
<p><span id="eq-multivar-cluster-wgss"><span class="math display">\[
WGSS = \sum_{j=1}^p \sum_{l=1}^{k} \sum_{ i \in G_l} (X_{ij} - c_{lj})^2
\tag{9.1}\]</span></span></p>
<p><a href="#eq-multivar-cluster-wgss" class="quarto-xref">식&nbsp;<span>9.1</span></a> 에서 <span class="math inline">\(c_{lj}\)</span> 는 <span class="math inline">\(l\)</span> 번째 군집에 속하는 개체들의 관측값 <span class="math inline">\(X_{ij}\)</span> 에 대한 군집의 중심값이다. 대표적인 군집의 중심값은 군집에 속한 개체들의 관측값들의 평균이며 다음과 같이 쓸 수있다.</p>
<p><span class="math display">\[
\bar X_{lj} =\frac{\sum_{i \in G_l} X_{ij} }{n_l} \equiv c_{lj}, \quad l=1,2,\dots, k, \quad j=1,2,\dots,p
\]</span></p>
<p><a href="#eq-multivar-cluster-wgss" class="quarto-xref">식&nbsp;<span>9.1</span></a> 의 그룹내 제곱합을 최소로 하는 K-평균 군집 분석 방법의 기본 절차는 다음과 같다.</p>
<ol type="1">
<li><p>초기화: 군집의 수 <span class="math inline">\(k\)</span>를 미리 정한다. 초기 중심점(centroid)을 무작위로 선택하거나 특정 방법으로 선택한다.</p></li>
<li><p>할당 단계: 각 개체를 가장 가까운 중심점에 할당하여 군집을 형성한다. 이때 거리는 유클리드 거리(Euclidean distance) 등 적절한 거리을 사용할 수 있다.</p></li>
<li><p>갱신 단계: 각 군집의 중심점을 해당 군집에 속한 개체들의 관측값을 이용하여 갱신한다.</p></li>
<li><p>반복: 할당 단계(2)와 갱신 단계(4)를 개체의 군집에 대한 할당이 변하지 않아서 중심점이 더 이상 변하지 않거나, 최대 반복 횟수에 도달할 때까지 반복한다.</p></li>
</ol>
<p>K-평균 군집 분석은 간단하고 효율적이지만, 군집의 수 <span class="math inline">\(K\)</span>를 미리 정해야 한다는 단점이 있다. 또한 초기 중심점의 선택에 따라 결과가 달라질 수 있다. 또한 실제 군집 모양과 다르게 군집의 모양이 구형 구조(spherical structure)로 나타나는 현상도 유의해야 한다.</p>
<p>이러한 단점에도 불구하고 K-평균 군집 분석은 대규모 데이터셋에 대해서도 효율적으로 작동하며, 다양한 분야에서 널리 사용되고 있다.</p>
<section id="예제-미국의-50개-주-범죄율-자료" class="level3" data-number="9.3.1">
<h3 data-number="9.3.1" class="anchored" data-anchor-id="예제-미국의-50개-주-범죄율-자료"><span class="header-section-number">9.3.1</span> 예제: 미국의 50개 주 범죄율 자료</h3>
<p>crime 데이터는 미국 50개 주에 대한 7가지 범죄율(인구 10만명당 살인, 성폭행, 강도, 폭력행위, 가택침입, 절도, 자동차 절도)을 포함하고 있다. <code>crime</code> 자료를 아래와 같이 생성하자.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">crime</span><span class="st">`</span> <span class="ot">&lt;-</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">structure</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">2.2</span>, <span class="dv">2</span>, <span class="fl">3.6</span>, <span class="fl">3.5</span>, <span class="fl">4.6</span>, <span class="fl">10.7</span>, <span class="fl">5.2</span>, <span class="fl">5.5</span>, <span class="fl">5.5</span>, <span class="dv">6</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fl">8.9</span>, <span class="fl">11.3</span>, <span class="fl">3.1</span>, <span class="fl">2.5</span>, <span class="fl">1.8</span>, <span class="fl">9.2</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="fl">3.1</span>, <span class="fl">4.4</span>, <span class="fl">4.9</span>, <span class="dv">9</span>, <span class="dv">31</span>, <span class="fl">7.1</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fl">5.9</span>, <span class="fl">8.1</span>, <span class="fl">8.6</span>, <span class="fl">11.2</span>, <span class="fl">11.7</span>, <span class="fl">6.7</span>, <span class="fl">10.4</span>, <span class="fl">10.1</span>, <span class="fl">11.2</span>, <span class="fl">8.1</span>, <span class="fl">12.8</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fl">8.1</span>, <span class="fl">13.5</span>, <span class="fl">2.9</span>, <span class="fl">3.2</span>, <span class="fl">5.3</span>, <span class="dv">7</span>, <span class="fl">11.5</span>, <span class="fl">9.3</span>, <span class="fl">3.2</span>, <span class="fl">12.6</span>, <span class="dv">5</span>, <span class="fl">6.6</span>, <span class="fl">11.3</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fl">8.6</span>, <span class="fl">4.8</span>, <span class="fl">14.8</span>, <span class="fl">21.5</span>, <span class="fl">21.8</span>, <span class="fl">29.7</span>, <span class="fl">21.4</span>, <span class="fl">23.8</span>, <span class="fl">30.5</span>, <span class="fl">33.2</span>, <span class="fl">25.1</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fl">38.6</span>, <span class="fl">25.9</span>, <span class="fl">32.4</span>, <span class="fl">67.4</span>, <span class="fl">20.1</span>, <span class="fl">31.8</span>, <span class="fl">12.5</span>, <span class="fl">29.2</span>, <span class="fl">11.6</span>, <span class="fl">17.7</span>, <span class="fl">24.6</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="fl">32.9</span>, <span class="fl">56.9</span>, <span class="fl">43.6</span>, <span class="fl">52.4</span>, <span class="fl">26.5</span>, <span class="fl">18.9</span>, <span class="fl">26.4</span>, <span class="fl">41.3</span>, <span class="fl">43.9</span>, <span class="fl">52.7</span>, <span class="fl">23.1</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="dv">47</span>, <span class="fl">28.4</span>, <span class="fl">25.8</span>, <span class="fl">28.9</span>, <span class="fl">40.1</span>, <span class="fl">36.4</span>, <span class="fl">51.6</span>, <span class="fl">17.3</span>, <span class="dv">20</span>, <span class="fl">21.9</span>, <span class="fl">42.3</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="fl">46.9</span>, <span class="dv">43</span>, <span class="fl">25.3</span>, <span class="fl">64.9</span>, <span class="fl">53.4</span>, <span class="fl">51.1</span>, <span class="fl">44.9</span>, <span class="fl">72.7</span>, <span class="dv">31</span>, <span class="dv">28</span>, <span class="dv">24</span>, <span class="dv">22</span>,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="dv">193</span>, <span class="dv">119</span>, <span class="dv">192</span>, <span class="dv">514</span>, <span class="dv">269</span>, <span class="dv">152</span>, <span class="dv">142</span>, <span class="dv">90</span>, <span class="dv">325</span>, <span class="dv">301</span>, <span class="dv">73</span>, <span class="dv">102</span>, <span class="dv">42</span>,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="dv">170</span>, <span class="dv">7</span>, <span class="dv">16</span>, <span class="dv">51</span>, <span class="dv">80</span>, <span class="dv">124</span>, <span class="dv">304</span>, <span class="dv">754</span>, <span class="dv">106</span>, <span class="dv">41</span>, <span class="dv">88</span>, <span class="dv">99</span>, <span class="dv">214</span>, <span class="dv">367</span>,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="dv">83</span>, <span class="dv">208</span>, <span class="dv">112</span>, <span class="dv">65</span>, <span class="dv">80</span>, <span class="dv">224</span>, <span class="dv">107</span>, <span class="dv">240</span>, <span class="dv">20</span>, <span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">145</span>, <span class="dv">130</span>, <span class="dv">169</span>,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="dv">59</span>, <span class="dv">287</span>, <span class="dv">135</span>, <span class="dv">206</span>, <span class="dv">343</span>, <span class="dv">88</span>, <span class="dv">106</span>, <span class="dv">102</span>, <span class="dv">92</span>, <span class="dv">103</span>, <span class="dv">331</span>, <span class="dv">192</span>, <span class="dv">205</span>,</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="dv">431</span>, <span class="dv">265</span>, <span class="dv">176</span>, <span class="dv">235</span>, <span class="dv">186</span>, <span class="dv">434</span>, <span class="dv">424</span>, <span class="dv">162</span>, <span class="dv">148</span>, <span class="dv">179</span>, <span class="dv">370</span>, <span class="dv">32</span>, <span class="dv">87</span>,  </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="dv">184</span>, <span class="dv">252</span>, <span class="dv">241</span>, <span class="dv">476</span>, <span class="dv">668</span>, <span class="dv">167</span>, <span class="dv">99</span>, <span class="dv">354</span>, <span class="dv">525</span>, <span class="dv">319</span>, <span class="dv">605</span>, <span class="dv">222</span>, <span class="dv">274</span>, </span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="dv">408</span>, <span class="dv">172</span>, <span class="dv">278</span>, <span class="dv">482</span>, <span class="dv">285</span>, <span class="dv">354</span>, <span class="dv">118</span>, <span class="dv">178</span>, <span class="dv">243</span>, <span class="dv">329</span>, <span class="dv">538</span>, <span class="dv">437</span>, <span class="dv">180</span>,</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="dv">354</span>, <span class="dv">244</span>, <span class="dv">286</span>, <span class="dv">521</span>, <span class="dv">401</span>, <span class="dv">103</span>, <span class="dv">803</span>, <span class="dv">755</span>, <span class="dv">949</span>, <span class="dv">1071</span>, <span class="dv">1294</span>, <span class="dv">1198</span>,</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="dv">1221</span>, <span class="dv">1071</span>, <span class="dv">735</span>, <span class="dv">988</span>, <span class="dv">887</span>, <span class="dv">1180</span>, <span class="dv">1509</span>, <span class="dv">783</span>, <span class="dv">1004</span>, <span class="dv">956</span>, <span class="dv">1136</span>,</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="dv">385</span>, <span class="dv">554</span>, <span class="dv">748</span>, <span class="dv">1188</span>, <span class="dv">1042</span>, <span class="dv">1296</span>, <span class="dv">1728</span>, <span class="dv">813</span>, <span class="dv">625</span>, <span class="dv">1225</span>, <span class="dv">1340</span>,</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="dv">1453</span>, <span class="dv">2221</span>, <span class="dv">824</span>, <span class="dv">1325</span>, <span class="dv">1159</span>, <span class="dv">1076</span>, <span class="dv">1030</span>, <span class="dv">1461</span>, <span class="dv">1787</span>, <span class="dv">2049</span>, <span class="dv">783</span>,</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="dv">1003</span>, <span class="dv">817</span>, <span class="dv">1792</span>, <span class="dv">1845</span>, <span class="dv">1908</span>, <span class="dv">915</span>, <span class="dv">1604</span>, <span class="dv">1861</span>, <span class="dv">1967</span>, <span class="dv">1696</span>, <span class="dv">1162</span>,</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="dv">1339</span>, <span class="dv">2347</span>, <span class="dv">2208</span>, <span class="dv">2697</span>, <span class="dv">2189</span>, <span class="dv">2568</span>, <span class="dv">2758</span>, <span class="dv">2924</span>, <span class="dv">2822</span>, <span class="dv">1654</span>, <span class="dv">2574</span>,</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="dv">2333</span>, <span class="dv">2938</span>, <span class="dv">3378</span>, <span class="dv">2802</span>, <span class="dv">2785</span>, <span class="dv">2801</span>, <span class="dv">2500</span>, <span class="dv">2049</span>, <span class="dv">1939</span>, <span class="dv">2677</span>, <span class="dv">3008</span>,</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="dv">3090</span>, <span class="dv">2978</span>, <span class="dv">4131</span>, <span class="dv">2522</span>, <span class="dv">1358</span>, <span class="dv">2423</span>, <span class="dv">2846</span>, <span class="dv">2984</span>, <span class="dv">4373</span>, <span class="dv">1740</span>, <span class="dv">2126</span>,</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="dv">2304</span>, <span class="dv">1845</span>, <span class="dv">2305</span>, <span class="dv">3417</span>, <span class="dv">3142</span>, <span class="dv">3987</span>, <span class="dv">3314</span>, <span class="dv">2800</span>, <span class="dv">3078</span>, <span class="dv">4231</span>, <span class="dv">3712</span>,</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a><span class="dv">4337</span>, <span class="dv">4074</span>, <span class="dv">3489</span>, <span class="dv">4267</span>, <span class="dv">4163</span>, <span class="dv">3384</span>, <span class="dv">3910</span>, <span class="dv">3759</span>, <span class="dv">164</span>, <span class="dv">228</span>, <span class="dv">181</span>,</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="dv">906</span>, <span class="dv">705</span>, <span class="dv">447</span>, <span class="dv">637</span>, <span class="dv">776</span>, <span class="dv">354</span>, <span class="dv">376</span>, <span class="dv">328</span>, <span class="dv">628</span>, <span class="dv">800</span>, <span class="dv">254</span>, <span class="dv">288</span>, <span class="dv">158</span>,</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a><span class="dv">439</span>, <span class="dv">120</span>, <span class="dv">99</span>, <span class="dv">168</span>, <span class="dv">258</span>, <span class="dv">272</span>, <span class="dv">545</span>, <span class="dv">975</span>, <span class="dv">219</span>, <span class="dv">169</span>, <span class="dv">208</span>, <span class="dv">277</span>, <span class="dv">430</span>,</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="dv">598</span>, <span class="dv">193</span>, <span class="dv">544</span>, <span class="dv">267</span>, <span class="dv">150</span>, <span class="dv">195</span>, <span class="dv">442</span>, <span class="dv">649</span>, <span class="dv">714</span>, <span class="dv">215</span>, <span class="dv">181</span>, <span class="dv">169</span>, <span class="dv">486</span>,</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a><span class="dv">343</span>, <span class="dv">419</span>, <span class="dv">223</span>, <span class="dv">478</span>, <span class="dv">315</span>, <span class="dv">402</span>, <span class="dv">762</span>, <span class="dv">604</span>, <span class="dv">328</span>), <span class="at">.Dim =</span> <span class="fu">c</span>(<span class="dv">51</span>L, <span class="dv">7</span>L</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>), <span class="at">.Dimnames =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"ME"</span>, <span class="st">"NH"</span>, <span class="st">"VT"</span>, <span class="st">"MA"</span>, <span class="st">"RI"</span>, <span class="st">"CT"</span>, <span class="st">"NY"</span>,</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a><span class="st">"NJ"</span>, <span class="st">"PA"</span>, <span class="st">"OH"</span>, <span class="st">"IN"</span>, <span class="st">"IL"</span>, <span class="st">"MI"</span>, <span class="st">"WI"</span>, <span class="st">"MN"</span>, <span class="st">"IA"</span>, <span class="st">"MO"</span>, <span class="st">"ND"</span>,</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a><span class="st">"SD"</span>, <span class="st">"NE"</span>, <span class="st">"KS"</span>, <span class="st">"DE"</span>, <span class="st">"MD"</span>, <span class="st">"DC"</span>, <span class="st">"VA"</span>, <span class="st">"WV"</span>, <span class="st">"NC"</span>, <span class="st">"SC"</span>, <span class="st">"GA"</span>,</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a><span class="st">"FL"</span>, <span class="st">"KY"</span>, <span class="st">"TN"</span>, <span class="st">"AL"</span>, <span class="st">"MS"</span>, <span class="st">"AR"</span>, <span class="st">"LA"</span>, <span class="st">"OK"</span>, <span class="st">"TX"</span>, <span class="st">"MT"</span>, <span class="st">"ID"</span>,</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a><span class="st">"WY"</span>, <span class="st">"CO"</span>, <span class="st">"NM"</span>, <span class="st">"AZ"</span>, <span class="st">"UT"</span>, <span class="st">"NV"</span>, <span class="st">"WA"</span>, <span class="st">"OR"</span>, <span class="st">"CA"</span>, <span class="st">"AK"</span>, <span class="st">"HI"</span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>), <span class="fu">c</span>(<span class="st">"Murder"</span>, <span class="st">"Rape"</span>, <span class="st">"Robbery"</span>, <span class="st">"Assault"</span>, <span class="st">"Burglary"</span>, <span class="st">"Theft"</span>,</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a><span class="st">"Vehicle"</span>)))</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>crime <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(crime)</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(crime)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Murder Rape Robbery Assault Burglary Theft Vehicle
ME    2.0 14.8      28     102      803  2347     164
NH    2.2 21.5      24      92      755  2208     228
VT    2.0 21.8      22     103      949  2697     181
MA    3.6 29.7     193     331     1071  2189     906
RI    3.5 21.4     119     192     1294  2568     705
CT    4.6 23.8     192     205     1198  2758     447</code></pre>
</div>
</div>
<p>이제 각 변수에 대한 산점도와 상관계수 행렬을 보자. 산점도에 보면 1개의 이상치가 존재하는 것을 알 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(crime,</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"cor"</span>, <span class="at">size =</span> <span class="dv">4</span>)), <span class="co"># 상관계수 표시</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"points"</span>, <span class="at">alpha=</span><span class="fl">0.3</span>, <span class="at">size=</span><span class="fl">0.5</span>)), <span class="co"># 산점도</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"barDiag"</span>, <span class="at">fill=</span><span class="st">"lightblue"</span>))) <span class="sc">+</span> <span class="co"># 히스토그램</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"noto"</span>))</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-cluster_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Washington D.C. 가 살인율이 너무 높아서 이상치로 나타나 분석에서 제외한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>crime <span class="sc">%&gt;%</span> <span class="fu">filter</span>( Murder <span class="sc">&gt;</span> <span class="dv">15</span>)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Murder Rape Robbery Assault Burglary Theft Vehicle
DC     31 52.4     754     668     1728  4131     975</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>crime2 <span class="ot">&lt;-</span> crime <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">rownames</span>(crime) <span class="sc">!=</span> <span class="st">"DC"</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(crime2)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Murder Rape Robbery Assault Burglary Theft Vehicle
ME    2.0 14.8      28     102      803  2347     164
NH    2.2 21.5      24      92      755  2208     228
VT    2.0 21.8      22     103      949  2697     181
MA    3.6 29.7     193     331     1071  2189     906
RI    3.5 21.4     119     192     1294  2568     705
CT    4.6 23.8     192     205     1198  2758     447</code></pre>
</div>
</div>
<p>각 변수에 대한 분산이 매우 다르므로 각 변수를 표준화한다. 이 때 표준화 방법은 각 변수를 그 범위(range) 로 나누어 주는 방법을 적용한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>crime_s <span class="ot">&lt;-</span> crime2 <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">where</span>(is.numeric),</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> {</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>        rng <span class="ot">&lt;-</span> <span class="fu">range</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>        (.) <span class="sc">/</span> (rng[<span class="dv">2</span>] <span class="sc">-</span> rng[<span class="dv">1</span>])</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(crime_s)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Murder      Rape    Robbery   Assault  Burglary     Theft   Vehicle
ME  0.160 0.2422259 0.05522682 0.1780105 0.4373638 0.7784411 0.2032218
NH  0.176 0.3518822 0.04733728 0.1605585 0.4112200 0.7323383 0.2825279
VT  0.160 0.3567921 0.04339250 0.1797557 0.5168845 0.8945274 0.2242875
MA  0.288 0.4860884 0.38067061 0.5776614 0.5833333 0.7260365 1.1226766
RI  0.280 0.3502455 0.23471400 0.3350785 0.7047930 0.8517413 0.8736059
CT  0.368 0.3895254 0.37869822 0.3577661 0.6525054 0.9147595 0.5539033</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(crime_s, var)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Murder       Rape    Robbery    Assault   Burglary      Theft    Vehicle 
0.07638350 0.05618847 0.04625407 0.05900647 0.05218049 0.06218510 0.06755843 </code></pre>
</div>
</div>
<p>K-평균 군집 분석을 수행하는 함수는 <code>kmeans()</code> 이다. 먼저 1부터 6까지 군집의 개수에 따른 그룹내 제곱합의 변화를 살펴보자. 군집의 개수를 정할 때 엘보우 방법(elbow method)을 사용한다. 엘보우 방법은 군집의 개수에 따른 그룹내 제곱합의 변화를 그래프로 나타내고, 그래프에서 급격한 변화가 일어나는 지점을 찾아 군집의 개수를 결정하는 방법이다.우</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(crime_s)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>wss <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">6</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>wss[<span class="dv">1</span>] <span class="ot">&lt;-</span> (n <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">sapply</span>(crime_s, var))</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    wss[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">kmeans</span>(crime_s,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">centers =</span> i)<span class="sc">$</span>withinss)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>wss</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20.568070 10.569006  8.824753  7.634718  6.853599  5.755424</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, wss, <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">xlab =</span> <span class="st">"Number of groups"</span>,</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Within groups sum of squares"</span>)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-cluster_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>위의 그래프에서 엘보우 방법을 적용하면 2개의 군집에서 꺽인 부분이 나타나므로 2개의 군집으로 k-평균 군집분석을 적용해 보자.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kmeans</span>(crime_s, <span class="at">centers =</span> <span class="dv">2</span>)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>K-means clustering with 2 clusters of sizes 22, 28

Cluster means:
     Murder      Rape   Robbery   Assault  Burglary     Theft   Vehicle
1 0.7494545 0.7425978 0.4516765 0.6889576 0.8406368 1.1170963 0.6868311
2 0.3791429 0.4059504 0.1456044 0.3177512 0.5033847 0.8506515 0.3061161

Clustering vector:
ME NH VT MA RI CT NY NJ PA OH IN IL MI WI MN IA MO ND SD NE KS DE MD VA WV NC 
 2  2  2  1  2  2  1  1  2  2  2  1  1  2  2  2  1  2  2  2  2  2  1  2  2  2 
SC GA FL KY TN AL MS AR LA OK TX MT ID WY CO NM AZ UT NV WA OR CA AK HI 
 1  1  1  2  1  2  2  2  1  1  1  2  2  2  1  1  1  2  1  1  1  1  1  2 

Within cluster sum of squares by cluster:
[1] 6.047951 4.521055
 (between_SS / total_SS =  48.6 %)

Available components:

[1] "cluster"      "centers"      "totss"        "withinss"     "tot.withinss"
[6] "betweenss"    "size"         "iter"         "ifault"      </code></pre>
</div>
</div>
<p>각 변수의 원래 척도로 중심점을 변환하려면 다음과 같이 한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>rge <span class="ot">&lt;-</span> <span class="fu">sapply</span>(crime2, <span class="cf">function</span>(x) <span class="fu">diff</span>(<span class="fu">range</span>(x)))</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kmeans</span>(crime_s, <span class="at">centers =</span> <span class="dv">2</span>)<span class="sc">$</span>centers <span class="sc">*</span> rge</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Murder     Rape  Robbery   Assault  Burglary     Theft   Vehicle
1  9.368182 376.4971 829.2781 555.98881  51.36291  640.0962 2070.7959
2 23.165629 232.6096 438.9973   3.97189 255.21604 1561.7962  247.0357</code></pre>
</div>
</div>
<p>주성분 분석을 이용하여 군집을 시각화해보자. 첫번쨰 주성분은 모든 범죄에 대한 평균 개념이며 두 번째 주성분은 성폭행, 가택침입, 절도와 다른 범죄의 차이로 해것할 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. 주성분 분석</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>crime_pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(crime_s, <span class="at">scale. =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>crime_pca</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Standard deviations (1, .., p=7):
[1] 2.1376534 0.9821717 0.7849079 0.5839701 0.4629549 0.4473740 0.3069276

Rotation (n x k) = (7 x 7):
               PC1        PC2         PC3         PC4        PC5         PC6
Murder   0.3794812 -0.2532759  0.60240357 -0.04387921  0.1992800 -0.32002112
Rape     0.3917234  0.2129042  0.08903091 -0.82757875 -0.2273617  0.04562582
Robbery  0.3811897 -0.4150948 -0.25857003  0.23354486 -0.5286578 -0.47190706
Assault  0.4096666 -0.1372090  0.30642169  0.32964915 -0.1893113  0.74117076
Burglary 0.4108901  0.3152629  0.01613341  0.24359841  0.5966670 -0.24104906
Theft    0.3104366  0.6973264 -0.22227257  0.24780086 -0.2909714 -0.03368514
Vehicle  0.3524385 -0.3372512 -0.64712080 -0.17097024  0.3906411  0.25344635
                PC7
Murder    0.5337639
Rape     -0.2337444
Robbery  -0.2425152
Assault  -0.1600352
Burglary -0.5079981
Theft     0.4698464
Vehicle   0.3117965</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. k-means 클러스터링</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>km <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(crime_s, <span class="at">centers =</span> <span class="dv">2</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. 데이터 프레임 생성</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>crime_pca_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(crime_pca<span class="sc">$</span>x[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cluster =</span> <span class="fu">factor</span>(km<span class="sc">$</span>cluster), <span class="at">state =</span> <span class="fu">rownames</span>(crime_s))</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. 시각화</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(crime_pca_df, <span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2, <span class="at">color =</span> cluster, , <span class="at">label =</span> state)) <span class="sc">+</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span>  <span class="co"># 점 위에 도시 이름 표시</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"PCA Plot with k-means (k = 2)"</span>,</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Principal Component 1"</span>,</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Principal Component 2"</span>,</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Cluster"</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-cluster_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="예제로마-브리튼-도자기-군집화" class="level3" data-number="9.3.2">
<h3 data-number="9.3.2" class="anchored" data-anchor-id="예제로마-브리튼-도자기-군집화"><span class="header-section-number">9.3.2</span> 예제:로마-브리튼 도자기 군집화</h3>
<p>자료는 로마-브리튼(Romano-British) 도자기에 대한 화학 분석 결과이다. 데이터 세트는 45점의 항아리에 대한 화학 분석 결과로 구성되며, 다음과 같이 제시된다. 자료는 세 지역에서 제작았으며 지역 1은 가마(kilns) 1, 지역 2는 가마 2와 3, 지역 3은 가마 4와 5를 포함하고 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(HSAUR2)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>필요한 패키지를 로딩중입니다: tools</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
다음의 패키지를 부착합니다: 'HSAUR2'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:tidyr':

    household</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pottery)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Al2O3 Fe2O3  MgO  CaO Na2O  K2O TiO2   MnO   BaO kiln
1  18.8  9.52 2.00 0.79 0.40 3.20 1.01 0.077 0.015    1
2  16.9  7.33 1.65 0.84 0.40 3.05 0.99 0.067 0.018    1
3  18.2  7.64 1.82 0.77 0.40 3.07 0.98 0.087 0.014    1
4  16.9  7.29 1.56 0.76 0.40 3.05 1.00 0.063 0.019    1
5  17.8  7.24 1.83 0.92 0.43 3.12 0.93 0.061 0.019    1
6  18.8  7.45 2.06 0.87 0.25 3.26 0.98 0.072 0.017    1</code></pre>
</div>
</div>
<p>먼저 45개 도자기의 표준화된 측정값에 대한 유클리드 거리 행렬을 계산해보자. 결과로 얻어진 <span class="math inline">\(45 \times 45\)</span> 행렬은 시각적으로 표현할 수 있으며 여기서는 <code>ggplot2</code>의 <code>geo_tile</code> 함수를 사용해 만들었다. 이러한 플롯은 비유사성 행렬의 각 셀을 색상 또는 회색값과 연관시킵니다. 거리 0인 셀(즉, 불일치 행렬의 대각선 요소)에는 빍은 색을, 유클리드 거리가 더 큰 셀에는 어두운 새으로나타내었다. 아래 그림에서 군집 간 차이가 작은(밝은 사각형) 최소 3개의 뚜렷한 군집이 존재하는 힌트을 주며, 다른 모든 셀에서는 훨씬 더 먼 거리가 나타나고 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 거리계산 부분은 그대로 사용</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>pots <span class="ot">&lt;-</span> <span class="fu">scale</span>(pottery[, <span class="fu">colnames</span>(pottery) <span class="sc">!=</span> <span class="st">"kiln"</span>], <span class="at">center =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>pottery_dist <span class="ot">&lt;-</span> <span class="fu">dist</span>(pots)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co"># dist 객체를 행렬로 바꾸고 long 형태로 변환</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>dist_mat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(pottery_dist)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>dist_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(dist_mat) <span class="sc">%&gt;%</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>row,</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"col"</span>,</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"distance"</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a><span class="co"># pot 번호를 factor 로 변환</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>dist_df <span class="ot">&lt;-</span> dist_df <span class="sc">%&gt;%</span></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">row =</span> <span class="fu">factor</span>(row, <span class="at">levels =</span> <span class="fu">rownames</span>(dist_mat)),</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">factor</span>(col, <span class="at">levels =</span> <span class="fu">rownames</span>(dist_mat))</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 흑백 heatmap (lattice의 color = FALSE와 유사)</span></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dist_df, <span class="fu">aes</span>(<span class="at">x =</span> col, <span class="at">y =</span> row, <span class="at">fill =</span> distance)) <span class="sc">+</span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Distance"</span>,</span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">low  =</span> <span class="st">"white"</span>,</span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">"black"</span></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Pot Number"</span>,</span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Pot Number"</span>,</span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distance Matrix of Pottery Data"</span></span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x  =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-cluster_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>이제 엘보우 그래프를 이용하여 군집의 개수에 따른 그룹내 제곱합의 변화를 보자. 3개의 군집으로 나누는 것이 가장 적합해 보인다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(pots)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>wss <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">6</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>wss[<span class="dv">1</span>] <span class="ot">&lt;-</span> (n <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">sapply</span>(pots, var))</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    wss[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">kmeans</span>(pots,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">centers =</span> i)<span class="sc">$</span>withinss)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, wss, <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">xlab =</span> <span class="st">"Number of groups"</span>,   </span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Within groups sum of squares"</span>)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-cluster_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>3개의 군집으로 분석을 수행하고, 각 도자기가 속한 군집과 실제 가마 정보를 교차표로 나타내 보자. 지역 1은 가마(kilns) 1, 지역 2는 가마 2와 3, 지역 3은 가마 4와 5 로 구성되어 있는 사실을 군집 분석의 결과로 확인할 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">29</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>pottery_cluster <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(pots, <span class="at">centers =</span> <span class="dv">3</span>)<span class="sc">$</span>cluster</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>pottery_cluster </span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 
 1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  3  3  3  3  3 
27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 
 3  3  3  3  3  3  3  3  3  2  2  2  2  2  2  2  2  2  2 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="sc">~</span> pottery_cluster <span class="sc">+</span> kiln, <span class="at">data =</span> pottery)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               kiln
pottery_cluster  1  2  3  4  5
              1 21  0  0  0  0
              2  0  0  0  5  5
              3  0 12  2  0  0</code></pre>
</div>
</div>
<p>참주분고석을로 이용한 시각화를 수행해 보자. 3개의 지역이 군집으로 뚜렷하게 구분되는 것을 알 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. PCA 수행</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>pots_pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(pots, <span class="at">scale. =</span> <span class="cn">TRUE</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. K-means 클러스터링</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>km <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(pots, <span class="at">centers =</span> <span class="dv">3</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. 데이터 프레임으로 변환</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>pots_pca_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(pots_pca<span class="sc">$</span>x[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cluster =</span> <span class="fu">factor</span>(km<span class="sc">$</span>cluster))</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. 시각화</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pots_pca_df, <span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"PCA Plot of Pottery Data with K-means Clusters (k = 3)"</span>,</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Principal Component 1"</span>,</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Principal Component 2"</span>,</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Cluster"</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-cluster_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "복사완료!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "복사완료!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation column-page-right">
  <div class="nav-page nav-page-previous">
      <a href="../qmd/multivar-factor.html" class="pagination-link" aria-label="탐색적 인자 분석">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">탐색적 인자 분석</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../qmd/multivar-anova.html" class="pagination-link" aria-label="다변량 분산분석">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">다변량 분산분석</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>