<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ko" xml:lang="ko"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.34">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>6&nbsp; 주성분 분석 – 다변량통계학-2025년 2학기</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../qmd/multivar-cancor.html" rel="next">
<link href="../qmd/multivar-discrim.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-c8ad9e5dbd60b7b70b38521ab19b7da4.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-d3c9390091c69a50683db05bc45f20d8.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "일치 없음",
    "search-matching-documents-text": "일치된 문서",
    "search-copy-link-title": "검색 링크 복사",
    "search-hide-matches-text": "추가 검색 결과 숨기기",
    "search-more-match-text": "추가 검색결과",
    "search-more-matches-text": "추가 검색결과",
    "search-clear-button-title": "제거",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "취소",
    "search-submit-button-title": "검색",
    "search-label": "검색"
  }
}</script>
<script type="text/javascript">
 window.MathJax = {
  tex: {
    macros: {
    RR: '{\\mathbb R}',                    // a simple string replacement
    hatmat:'{\\pmb X ({\\pmb X}^t {\\pmb X} )^{-1} {\\pmb X}^t}',
    bold: ['\\boldsymbol{#1}',1] ,     // this macro has one parameter
    pardiff: ['\\frac{\\partial#2}{\\partial#1}', 2, 'x'], // this macro has an optional parameter that defaults to 'x'
    pardifftwo: ['\\frac{\\partial#1}{\\partial#2}', 2],
    pardiffd: ['\\frac{\\partial#1}{\\partial#2^t \\partial#2}', 2],
    pardiffdd: ['\\frac{\\partial#1}{\\partial#3 \\partial#2}', 3],
    norm: ['\\lVert#1\\rVert',1]
  },
  environments: {
  braced: ["\\left\\{", "\\right\\}"]
  }
 }
};
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="사이드바 전환" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../qmd/multivar-pca.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">주성분 분석</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="사이드바 전환" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="검색" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">다변량통계학-2025년 2학기</a> 
        <div class="sidebar-tools-main">
    <a href="../다변량통계학-2025년-2학기.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="검색"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/multivar-dist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">확률벡터와 다변량 정규분포</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/multivar-vis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">다변량 자료의 시각화</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/multivar-test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">다변량 가설 검정</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/multivar-cov.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">공분산 행렬의 추정</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/multivar-discrim.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">판별분석</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/multivar-pca.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">주성분 분석</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/multivar-cancor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">정준상관분석</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/math_mat_basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">행렬의 기초</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/math_eigen_value.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">고유값과 고유벡터</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/math_matrix_decomp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">행렬의 분해</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/app-likelihood-ratio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">가능도비 검정</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">목차</h2>
   
  <ul>
  <li><a href="#이변량-확률벡터의-변환" id="toc-이변량-확률벡터의-변환" class="nav-link active" data-scroll-target="#이변량-확률벡터의-변환"><span class="header-section-number">6.1</span> 이변량 확률벡터의 변환</a>
  <ul class="collapse">
  <li><a href="#이변량-정규분포" id="toc-이변량-정규분포" class="nav-link" data-scroll-target="#이변량-정규분포"><span class="header-section-number">6.1.1</span> 이변량 정규분포</a></li>
  <li><a href="#주성분의-기준과-생성방법" id="toc-주성분의-기준과-생성방법" class="nav-link" data-scroll-target="#주성분의-기준과-생성방법"><span class="header-section-number">6.1.2</span> 주성분의 기준과 생성방법</a></li>
  <li><a href="#상관계수행렬을-통한-주성분분석" id="toc-상관계수행렬을-통한-주성분분석" class="nav-link" data-scroll-target="#상관계수행렬을-통한-주성분분석"><span class="header-section-number">6.1.3</span> 상관계수행렬을 통한 주성분분석</a></li>
  <li><a href="#표본자료를-이용한-주성분분석" id="toc-표본자료를-이용한-주성분분석" class="nav-link" data-scroll-target="#표본자료를-이용한-주성분분석"><span class="header-section-number">6.1.4</span> 표본자료를 이용한 주성분분석</a></li>
  </ul></li>
  <li><a href="#주성분-분석의-기초이론" id="toc-주성분-분석의-기초이론" class="nav-link" data-scroll-target="#주성분-분석의-기초이론"><span class="header-section-number">6.2</span> 주성분 분석의 기초이론</a>
  <ul class="collapse">
  <li><a href="#주성분의-정의" id="toc-주성분의-정의" class="nav-link" data-scroll-target="#주성분의-정의"><span class="header-section-number">6.2.1</span> 주성분의 정의</a></li>
  <li><a href="#양정치-행렬의-스펙트럼분해" id="toc-양정치-행렬의-스펙트럼분해" class="nav-link" data-scroll-target="#양정치-행렬의-스펙트럼분해"><span class="header-section-number">6.2.2</span> 양정치 행렬의 스펙트럼분해</a></li>
  <li><a href="#이차형식의-최대값" id="toc-이차형식의-최대값" class="nav-link" data-scroll-target="#이차형식의-최대값"><span class="header-section-number">6.2.3</span> 이차형식의 최대값</a></li>
  <li><a href="#주성분의-계수" id="toc-주성분의-계수" class="nav-link" data-scroll-target="#주성분의-계수"><span class="header-section-number">6.2.4</span> 주성분의 계수</a></li>
  <li><a href="#공분산행렬과-상관계수행렬" id="toc-공분산행렬과-상관계수행렬" class="nav-link" data-scroll-target="#공분산행렬과-상관계수행렬"><span class="header-section-number">6.2.5</span> 공분산행렬과 상관계수행렬</a></li>
  </ul></li>
  <li><a href="#주성분-분석" id="toc-주성분-분석" class="nav-link" data-scroll-target="#주성분-분석"><span class="header-section-number">6.3</span> 주성분 분석</a>
  <ul class="collapse">
  <li><a href="#주성분-개수의-선택" id="toc-주성분-개수의-선택" class="nav-link" data-scroll-target="#주성분-개수의-선택"><span class="header-section-number">6.3.1</span> 주성분 개수의 선택</a></li>
  <li><a href="#주성분의-척도변경" id="toc-주성분의-척도변경" class="nav-link" data-scroll-target="#주성분의-척도변경"><span class="header-section-number">6.3.2</span> 주성분의 척도변경</a></li>
  <li><a href="#주성분-점수" id="toc-주성분-점수" class="nav-link" data-scroll-target="#주성분-점수"><span class="header-section-number">6.3.3</span> 주성분 점수</a></li>
  </ul></li>
  <li><a href="#예제-올림픽-7종-경기-자료" id="toc-예제-올림픽-7종-경기-자료" class="nav-link" data-scroll-target="#예제-올림픽-7종-경기-자료"><span class="header-section-number">6.4</span> 예제: 올림픽 7종 경기 자료</a></li>
  <li><a href="#예제-포도주-자료" id="toc-예제-포도주-자료" class="nav-link" data-scroll-target="#예제-포도주-자료"><span class="header-section-number">6.5</span> 예제: 포도주 자료</a>
  <ul class="collapse">
  <li><a href="#자료-불러오기" id="toc-자료-불러오기" class="nav-link" data-scroll-target="#자료-불러오기"><span class="header-section-number">6.5.1</span> 자료 불러오기</a></li>
  <li><a href="#주성분-분석-1" id="toc-주성분-분석-1" class="nav-link" data-scroll-target="#주성분-분석-1"><span class="header-section-number">6.5.2</span> 주성분 분석</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content column-page-right" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">주성분 분석</span></h1>
</div>



<div class="quarto-title-meta column-page-right">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(HSAUR2)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pheatmap)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#아래 3 문장은 한글을 포함한 ggplot 그림이 포함된 HTML, PDF로 만드는 경우 사용</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(showtext)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#font_add_google("Nanum Pen Script", "gl")</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">font_add_google</span>(<span class="at">name =</span> <span class="st">"Noto Sans KR"</span>, <span class="at">family =</span> <span class="st">"noto"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">showtext_auto</span>()</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>다변량 데이터를 다룰 때 문제점 중 하나는 단순히 변수가 너무 많아 데이터에 대한 유익한 초기 평가를 성공적으로 수행하기 어렵다는 점이다. 변수들 사이의 복잡한 상관관계는 분석에 어려움을 더한다. 또한 변수가 너무 많으면 연구자가 데이터에 적용하고자 하는 다른 다변량 기법에도 문제를 일으킬 수 있다.빅데이터가 흔한 시데에 데이터는 넘쳐나지만, 그 속에서 진짜 중요한 정보를 찾아내는 일은 점점 더 어려워지고 있다.</p>
<p>주성분 분석(PCA, Principal Component Analysis)은 단순히 하나의 통계 기법을 넘어, 데이터를 이해하는 새로운 방식을 제시한다. 주성분 분석은 다변량 자료의 변수들 속에 숨어 있는 공통된 구조를 발견하고, 이를 소수의 새로운 변수로 변환하는과정이다. 수십 개의 변수를 그대로 바라보면 혼란스러울 뿐이다. PCA는 이 변수들을 새로운 좌표계로 옮겨, 가장 큰 변동을 담아내는 방향으로 새로운 변수를 찾아낸다. 첫 번째 주성분이 데이터의 전체 흐름을 포착하고, 두 번째 주성분이 남은 변동을 설명한다. 이렇게 서로 직교하는 변수들이 순차적으로 만들어지면서, 데이터가 가지고 있는 변동을 2-3 개의 새로운 변수로 단순하게 많은 부분을 설명할 수 있다.</p>
<p>주성분 분석의 목적은 분명하다. 첫째, 차원을 축소하여 핵심적인 소수의 변수들만 남기는 것이다. 복잡한 다변량을 2-3 개의 주성분으로 요약하면, 분석은 훨씬 단순해진다. 주성분 분석은 자료가 많은 수의 변수들(Variables)로 구성되어 있는 경우 적은 개수의 변수로 자료의 차원을 축소하는 것이 주요한 목적이다(Dimension Reduction). 또한 이렇게 차원을 축소하는 경우 원래 변수들이 가지고 있던 변동(Variation)을 차원이 축소된 경우에도 최대한 유지할 수 있도록 한다.</p>
<p>둘째로 주성분 분석은 데이터의 시각화를 더욱 쉽게 수행할 수 있다. 수십 차원의 세계를 2차원, 3차원으로 투영해 보면, 군집은 또렷해지고 이상치는 드러난다. 셋째, 주어진 변수들의 복잡한 상관관계를 검토하고 분석할 필요가 없어진다. 서로 얽힌 변수들을 직교하는 주성분으로 바꿔놓으면, 다중공선성이라는 문제는 자연스레 사라진다.</p>
<p>주성분 분석은 특정 학문에만 국한되지 않는다. 사회과학에서 복잡한 설문 문항을 요약하는 데, 생물학에서 유전자 발현 데이터의 패턴을 찾는 데, 경영학에서 고객 행동의 핵심 요인을 도출하는 데, 더 나아가 인공지능에서 이미지나 텍스트의 고차원 정보를 다루는 데까지, 그 쓰임새는 한계가 없다.</p>
<section id="이변량-확률벡터의-변환" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="이변량-확률벡터의-변환"><span class="header-section-number">6.1</span> 이변량 확률벡터의 변환</h2>
<section id="이변량-정규분포" class="level3" data-number="6.1.1">
<h3 data-number="6.1.1" class="anchored" data-anchor-id="이변량-정규분포"><span class="header-section-number">6.1.1</span> 이변량 정규분포</h3>
<p>먼저 주성분분석의 기본개념을 이해하기 위하여 다음과 같은 평균 <span class="math inline">\(\pmb  \mu\)</span>인 이차원 확률벡터 <span class="math inline">\(\pmb  X =(X_1, X_2)^t\)</span> 가 아래와 같이 공분산을 가지는 정규분포를 따른다고 하자.</p>
<p><span class="math display">\[
\pmb  X \sim N_2( \pmb  \mu, \pmb  \Sigma), \quad
E(\pmb  X) =  \pmb  \mu =
\begin{bmatrix}
\mu_1 \\
\mu_2
\end{bmatrix}, \quad
\pmb  \Sigma = V(\pmb  X) =
\begin{bmatrix}
\sigma_{11} &amp; \sigma_{12} \\
\sigma_{12} &amp; \sigma_{22} \\
\end{bmatrix}
\]</span></p>
<p>확률벡터 <span class="math inline">\(\pmb  X\)</span>의 상관계수행렬 <span class="math inline">\(\pmb  C\)</span> 는 다음과 같이 표시한다. <span class="math display">\[
\pmb  C =
\begin{bmatrix}
1 &amp; \rho \\
\rho &amp; 1 \\
\end{bmatrix},
\quad
\rho = \frac{\sigma_{12}}{ \sqrt{\sigma_{11} \sigma_{22}}}
\]</span></p>
<p>참고할 사항은 상관계수행렬은 표준화된 확률변수 <span class="math inline">\(Z_i = (X_i - \mu _i)/\sqrt{\sigma_{ii}}\)</span>의 공분산 행렬이다. 이유는 다음과 같이 보일 수 있다. 일단 표준화된 확률벡터 <span class="math inline">\(\pmb  Z = (Z_1, Z_2)^t\)</span>를 정의하자.</p>
<p><span class="math display">\[
\pmb  Z =
\begin{bmatrix}
(X_1 - \mu _1)/\sqrt{\sigma_{11}} \\
(X_2 - \mu _2)/\sqrt{\sigma_{22}}
\end{bmatrix}
=
\begin{bmatrix}
1/\sqrt{\sigma_{11}} &amp; 0 \\
0 &amp; 1/\sqrt{\sigma_{22}} \\
\end{bmatrix}
\begin{bmatrix}
(X_1 - \mu _1) \\
(X_2 - \mu _2)
\end{bmatrix}
= \pmb  D (\pmb  X  - \pmb  \mu)
\]</span> 여기서 <span class="math inline">\(\pmb  D\)</span>는 각 변수의 표준편차의 역수를 대각원소로 가지는 대각 행렬이다. 표준화된 확률벡터 <span class="math inline">\(\pmb  Z\)</span>의 공분산은 다음과 같이 유도된다.</p>
<p><span class="math display">\[
\begin{aligned}
V(\pmb  Z ) &amp;=  E( [\pmb  D (\pmb  X  - \pmb  \mu)] [\pmb  D (\pmb  X  - \pmb  \mu)]^t ) \\
&amp;=  \pmb  D E(  (\pmb  X  - \pmb  \mu)  (\pmb  X  - \pmb  \mu)^t ) \pmb  D^t  \\
&amp;=  \pmb  D \Sigma \pmb  D^t \\
&amp;=
\begin{bmatrix}
1/\sqrt{\sigma_{11}} &amp; 0 \\
0 &amp; 1\sqrt{\sigma_{22}} \\
\end{bmatrix}
\begin{bmatrix}
\sigma_{11} &amp; \sigma_{12} \\
\sigma_{12} &amp; \sigma_{22} \\
\end{bmatrix}
\begin{bmatrix}
1/\sqrt{\sigma_{11}} &amp; 0 \\
0 &amp; 1\sqrt{\sigma_{22}} \\
\end{bmatrix} \\
&amp;=
\begin{bmatrix}
1 &amp; \rho \\
\rho &amp; 1 \\
\end{bmatrix}
\end{aligned}
\]</span></p>
</section>
<section id="주성분의-기준과-생성방법" class="level3" data-number="6.1.2">
<h3 data-number="6.1.2" class="anchored" data-anchor-id="주성분의-기준과-생성방법"><span class="header-section-number">6.1.2</span> 주성분의 기준과 생성방법</h3>
<p>일반적으로 주성분 분석에서는 확률벡터 <span class="math inline">\(\pmb  X\)</span>의 평균이 <span class="math inline">\(\pmb  0\)</span>이라고 가정한다. 주성분 분석은 원래 변수들의 위치(location, 즉 평균)에 영향을 받는 방법이 아니라 자료의 변동(variation, 즉 분산)을 최대로 유지하는 새로운 변수를 만드는 것이 목적이다. 따라서 평균이 <span class="math inline">\(\pmb  0\)</span>이 아닌 확률벡터 <span class="math inline">\(\pmb  X_*\)</span>도 그 평균을 뺀 벡터 <span class="math inline">\(\pmb  X\)</span>로 변환하여 평균을 <span class="math inline">\(\pmb  0\)</span>으로 만들고 주성분분석을 적용한다.<br>
<span class="math display">\[ \text{Let } \pmb  X = \pmb  X_* - E(\pmb  X_* )=\pmb  X_* - \pmb  \mu_* ,
\text{ then } E(\pmb  X)=0, ~~ V(\pmb  X) = V(\pmb  X_*)  \]</span> 아래부터는 특별한 언급이 없으면 확률벡터 <span class="math inline">\(\pmb  X\)</span>가 평균이 <span class="math inline">\(\pmb  0\)</span>이라고 가정한다.</p>
<p>이제 평균이 0이고 공분산(상관계수행렬)이 다음과 같이 주어지는 이변량정규분포를 생각해보자. <span id="eq-multivar-pca-sigma1"><span class="math display">\[
\pmb  \Sigma =
\begin{bmatrix}
2 &amp; 1.5\\
1.5 &amp; 2
\end{bmatrix}
\tag{6.1}\]</span></span></p>
<p>참고로 두 변수의 상관계수는 <span class="math inline">\(\rho = 1.5/2 = 0.75\)</span> 이다</p>
<p><code>R</code> 의 패키지 중 <code>mtvnorm</code> 을 사용하면 다변량분포에 대한 다양한작업을 손쉽게 할 수 있다. 다음 <code>R</code> 프로그램은 위에 주어진 공분산행렬 을 가지는 이변량정규분포 화률밀도함수의 2차원 등고선그림이다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="do">#### 평균과 공분산</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">1.5</span>, <span class="fl">1.5</span>, <span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># grid 만들기</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>x.points <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>y.points <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> x.points, <span class="at">x2 =</span> y.points)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="do">#### 확률밀도 계산</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>grid<span class="sc">$</span>z <span class="ot">&lt;-</span> <span class="fu">dmvnorm</span>(grid[, <span class="fu">c</span>(<span class="st">"x1"</span>, <span class="st">"x2"</span>)], <span class="at">mean =</span> mu, <span class="at">sigma =</span> sigma)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="do">#### ggplot으로 contour 그리기</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(grid, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> z)) <span class="sc">+</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span> ,<span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"blue"</span>,<span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="fl">1.5</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="fl">0.5</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"X_1"</span>, <span class="at">y =</span> <span class="st">"X_2"</span>, <span class="at">title =</span> <span class="st">"이차원 정규분포의 확률빌도함수(rho = 0.75) "</span>) </span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-pca_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>위의 그림에서 이차원 평면 상의 이차원 정규분포 밀도함수 등고선을 보면 분포의 퍼진 정도가 가장 큰 방향의 축이 원점을 지나고 기울기가 1 인 직선임을 알 수 있다(빨간 색 직선) 또한 이 직선과 직교하는 선은 원점을 지나고 기울기가 -1 인 직선임을 알 수 있다(파란 색 직선 )</p>
<p>이제 각 확률변수 <span class="math inline">\(X_i\)</span> 의 선형 변환으로 새로운 확률변수 <span class="math inline">\(Z_i\)</span> 를 다음과 같이 정의한다.</p>
<p><span class="math display">\[ Z_1 = a_{11} X_1 + a_{12} X_2, \quad Z_2 = a_{21} X_1 + a_{22} X_2 \]</span> 새로운 확률벡터 <span class="math inline">\(\pmb  Z =(Z_1, Z_2)^t\)</span> 는 다음과 같이 표시할 수 있다. <span id="eq-multivar-pca-trans1"><span class="math display">\[
\pmb  Z = \pmb  A \pmb  X \text{ where }
\pmb  A =
\begin{bmatrix}
a_{11} &amp; a_{12} \\
a_{21} &amp; a_{22}
\end{bmatrix}
\tag{6.2}\]</span></span></p>
<p>이렇게 새로운 확률 변수 <span class="math inline">\(Z_i\)</span>를 만들 때 첫번째 변수 <span class="math inline">\(Z_1\)</span> 를 첫번째 주성분(the 1st Principal Component)이라고 하며 원래 확률 벡터 <span class="math inline">\(\pmb  X\)</span>가 가지는 총 변동 중에 최대한 큰 변동을 가질 수 있도록 만들고(빨간 색 직선 방향) 두번째 변수 <span class="math inline">\(Z_2\)</span> 를 두번째 주성분(the 2nd Principal Component) 이라고 부르고 첫번째 변수 <span class="math inline">\(Z_1\)</span>과 공분산이 0 이면서 나머지 변동을 가질 수 있도록(파란색 직선 방향) 만드는 방법이 주성분(principal components)을 만드는 기준이다.</p>
<ol type="1">
<li><span class="math inline">\(\max V(Z_1)\)</span></li>
<li><span class="math inline">\(Cov(Z_1,Z_2) =0\)</span></li>
<li><span class="math inline">\(V(Z_1) + V(Z_2) = V(X_1) + V(X_2)\)</span></li>
</ol>
<p>위의 조건을 만족하는 선형변환 <span class="math inline">\(\pmb  Z\)</span>는 공분산행렬 <span class="math inline">\(\pmb  \Sigma\)</span>의 고유값과 고유벡터로 구할 수 있다. <a href="#eq-multivar-pca-sigma1" class="quarto-xref">식&nbsp;<span>6.1</span></a> 에 주어진 공분산행렬은 양정치 행렬이므로 고유값(eigen value) <span class="math inline">\(\lambda_1 &gt; \lambda_2&gt;0\)</span>가 모두 양수이고 각 고유치에 대응하는 정규 직교 고유벡터(orthonormal eigen vector)의 행렬 <span class="math inline">\(\pmb  P\)</span>을 이용하여 다음과 같은 분해가 가능하다.</p>
<p><span id="eq-multivar-pca-sigma-decomp"><span class="math display">\[
\Sigma = \pmb  P \pmb  \Lambda \pmb  P^t  
\tag{6.3}\]</span></span></p>
<p>여기서 <a href="#eq-multivar-pca-sigma1" class="quarto-xref">식&nbsp;<span>6.1</span></a> 에 대해서 <a href="#eq-multivar-pca-sigma-decomp" class="quarto-xref">식&nbsp;<span>6.3</span></a> 에 주어진 행렬의 분해를 구해보면 아래와 같다.</p>
<p><span class="math display">\[
\pmb  \Lambda =
\begin{bmatrix}
\lambda_1 &amp; 0\\
0 &amp; \lambda_2
\end{bmatrix}
=
\begin{bmatrix}
7/2 &amp; 0\\
0 &amp; 1/2
\end{bmatrix}
, \quad
\pmb  P =
\begin{bmatrix}
1/\sqrt{2} &amp; -1/\sqrt{2}\\
1/\sqrt{2}  &amp; 1/\sqrt{2}
\end{bmatrix}
\]</span> <a href="#eq-multivar-pca-trans1" class="quarto-xref">식&nbsp;<span>6.2</span></a> 에서 정의된 선형변환을 다음과 같이 정의하면</p>
<p><span class="math display">\[  
\pmb  A = \pmb  P^t \text{ so that } \pmb  Z = \pmb  P^t \pmb  X
\]</span> 주성분은 다음과 같이 만들어 진다. <span class="math display">\[
Z_1 = \frac{1}{\sqrt{2}} X_1 + \frac{1}{\sqrt{2}} X_2, \quad Z_2 = -\frac{1}{\sqrt{2}} X_1 + \frac{1}{\sqrt{2}} X_2
\]</span></p>
<p>이렇게 만들어진 주성분 벡터의 공분산 행렬을 구해보자</p>
<p><span class="math display">\[
\begin{aligned}
V(\pmb  Z) &amp; = V(\pmb  P^t \pmb  X) \\
&amp; = \pmb  P^t V(\pmb  X) \pmb  P \\
&amp; = \pmb  P^t \pmb  \Sigma \pmb  P \\
&amp; = \pmb  P^t  \pmb  P \pmb  \Lambda \pmb  P^t  \pmb  P  \\
&amp; = \pmb  \Lambda
\end{aligned}
\]</span></p>
<p>위의 유도식에서 정규직교 고유벡터 <span class="math inline">\(\pmb  P\)</span>는 직교행렬이므로 (i.e.&nbsp;<span class="math inline">\(\pmb  P^t  \pmb  P=\pmb  I\)</span>)</p>
<p><span class="math display">\[  
V(\pmb  Z)  =  \pmb  \Lambda = \begin{bmatrix}
7/2 &amp; 0\\
0 &amp; 1/2
\end{bmatrix}
\]</span> 따라서 첫번째 주성분의 분산은 가장 큰 고유치가 되고 두 번째 주성분의 분산은 두 번째 고유치가 되며 두 주성분의 공분산은 0이고 정규분포이므로 독립이다. <span class="math display">\[ \pmb  Z  \sim N_2( \pmb  0 , \pmb  \Lambda) \]</span> 또한 다음의 관계가 성립한다.</p>
<p><span class="math display">\[ V(Z_1)=3.5,~~ V(Z_2)=0.5,~~ Cov(Z_1,Z_2) =0,~~  V(Z_1) + V(Z_2) = V(X_1) + V(X_2) \]</span></p>
<p>다음은 주성분 벡터 <span class="math inline">\(\pmb  Z\)</span>의 이변량정규분포의 2차원 등고선그림이다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 평균 벡터와 공분산 행렬</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>sigma1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">3.5</span>, <span class="dv">0</span>, </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                  <span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># x, y 격자 만들기</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>x.points <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>y.points <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x =</span> x.points, <span class="at">y =</span> y.points)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 이변량 정규분포 밀도 계산</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>grid<span class="sc">$</span>z <span class="ot">&lt;-</span> <span class="fu">dmvnorm</span>(<span class="fu">cbind</span>(grid<span class="sc">$</span>x, grid<span class="sc">$</span>y), <span class="at">mean =</span> mu, <span class="at">sigma =</span> sigma1)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot2 시각화</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(grid, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">z =</span> z)) <span class="sc">+</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Z_1"</span>, <span class="at">y =</span> <span class="st">"Z_2"</span>, <span class="at">title =</span> <span class="st">"두 주성분의 분포"</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-pca_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>위와 같이 만든 첫번째 주성분은 원래 변수가 가지고 있는 총변동 <span class="math inline">\(V(X_1)+V(X_2) = 4\)</span>의 85.7%를 설명한다.</p>
<p><span class="math display">\[
\frac{V(Z_1)}{V(X_1)+V(X_2)} = \frac{V(Z_1)}{V(Z_1)+V(Z_2)}
= \frac{\lambda_1}{\lambda_1+\lambda_2} = \frac{3.5}{4} = 0.857
\]</span></p>
<p>원래의 두 변수 <span class="math inline">\(X_1\)</span>과 <span class="math inline">\(X_2\)</span>를 모두 사용하지 않고 하나의 주성분 <span class="math inline">\(Z_1\)</span>만으로서 분포의 전체 변동의 큰 부분(85.7%)을 설명할 수 있다. 이러한 논리가 주성분을 이용한 차원의 축소이다.</p>
</section>
<section id="상관계수행렬을-통한-주성분분석" class="level3" data-number="6.1.3">
<h3 data-number="6.1.3" class="anchored" data-anchor-id="상관계수행렬을-통한-주성분분석"><span class="header-section-number">6.1.3</span> 상관계수행렬을 통한 주성분분석</h3>
<p>각 변수는 숫자로 나타나므로 측정할 경우 그 단위(unit)가 있다. 하지만 측정 단위들은 변수에 따라 또는 측정하는 사람에 따라 다를 수 있다. 예를 들어 키를 측정하는 경우 센티미터(cm)를 사용하고 몸무게를 측정하는 경우 킬로그램(Kg)를 사용한다. 또한 같은 변수인 키를 측정하는 경우에 센티미터(cm)대신 미터(m)를 사용할 수도 있다.</p>
<p>공분산행렬은 각 변수의 측정단위에 따라 변하며 그에 따른 고유값과 고유벡터도 변한다. 즉 주성분분석은 변수의 측정 단위에 따라 변할 수 있다.</p>
<p>예를 들어 <a href="#eq-multivar-pca-sigma1" class="quarto-xref">식&nbsp;<span>6.1</span></a> 을 공분산으로 가지는 확률벡터에서 첫번째 확률변수 <span class="math inline">\(X_1\)</span>를 키라고 하고 그 측정단위가 미터(m)라고 가정하자. 만약 키의 측정단위를 센티미터로 바꾼다면 <span class="math inline">\((100 \times X_1)\)</span> 단위가 바뀐 확률벡터의 공분산행렬은 다음과 같이 변한다.</p>
<p><span id="eq-multivar-pca-sigma2"><span class="math display">\[
\pmb  \Sigma =
\begin{bmatrix}
(10000)(2) &amp; (100)(1.5)\\
(100)(1.5) &amp; 2
\end{bmatrix}
=
\begin{bmatrix}
20000 &amp; 150\\
150 &amp; 2
\end{bmatrix}
\tag{6.4}\]</span></span></p>
<p>위에서 변환된 공분산행렬의 고유값과 고유벡터를 구해보면 다음과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">20000</span>,<span class="dv">150</span>,<span class="dv">150</span>,<span class="dv">2</span>),<span class="at">nrow=</span><span class="dv">2</span>) <span class="co"># 공분산행렬</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>sigma</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1] [,2]
[1,] 20000  150
[2,]   150    2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">eigen</span>(sigma)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>eigen() decomposition
$values
[1] 2.000113e+04 8.749508e-01

$vectors
             [,1]         [,2]
[1,] -0.999971874  0.007500117
[2,] -0.007500117 -0.999971874</code></pre>
</div>
</div>
<p>가장 큰 고유치는 <span class="math inline">\(\lambda_1= 20000\)</span>에 가깝고 다음 고유치는 거의 0이다 (<span class="math inline">\(\lambda_2 \sim 0\)</span>) 또한 고유벡터는 거의 단위행렬에 가까우므로 첫번째 주성분은 키를 나타내는 원래 변수와 동일하고(부호만 바뀐다) 전체 변동을 대부분 설명하며 두번째 주성분은 거의 설명하는 변동이 없게된다.</p>
<p>위와 같은 현상은 공분산행렬을 주성분분석에 사용하는 경우에 나타나는 큰 문제점이다. 많은 경우 변수들은 측정단위가 다르며 단위를 바꾸면 주성분이 크게 변한다. 이러한 분제점을 해결하기 위하여 많은 경우 각 변수를 표준화하여 사용하는 것이 좋다. 표준화하면 각 변수가 가지는 변동이 같게되며 서로의 관계는 상관계수로 파악할 수 있다. 앞에서 표준화된 변수들의 공분산행렬은 상관계수행렬임을 보였다. 따라서 특별한 이유가 없는 한 주성분분석은 상관계수 행렬을 사용한다.</p>
<p>만약 두개의 확률벡터가 각각 <a href="#eq-multivar-pca-sigma1" class="quarto-xref">식&nbsp;<span>6.1</span></a> 과 <a href="#eq-multivar-pca-sigma2" class="quarto-xref">식&nbsp;<span>6.4</span></a> 를 공분산으로 갖는다고 가정하자. 두 공분산행렬은 다르지만 상관계수행렬은 같음을 알수 있다.</p>
<p><span id="eq-multivar-pca-cor1"><span class="math display">\[
\pmb  C =\begin{bmatrix}
1 &amp; \rho \\
\rho &amp; 1 \\
\end{bmatrix}
= \begin{bmatrix}
1 &amp; 0.75 \\
0.75 &amp; 1 \\
\end{bmatrix}
\tag{6.5}\]</span></span></p>
<p>따라서 단위의 종류와 변환에 관계없이 같은 주성분을 가진다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.75</span>,<span class="fl">0.75</span>,<span class="dv">1</span>),<span class="at">nrow=</span><span class="dv">2</span>) <span class="co"># 상관계수행렬(상관계수=0.75)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">eigen</span>(sigma)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>eigen() decomposition
$values
[1] 1.75 0.25

$vectors
          [,1]       [,2]
[1,] 0.7071068 -0.7071068
[2,] 0.7071068  0.7071068</code></pre>
</div>
</div>
<p>위에서 구한 고유치와 고유벡터를 사용한 주성분과 그 통계적 성질은 다음과 같다.</p>
<p><span class="math display">\[
Z_1 = \frac{1}{\sqrt{2}} X_1 + \frac{1}{\sqrt{2}} X_2, \quad Z_2 = -\frac{1}{\sqrt{2}} X_1 + \frac{1}{\sqrt{2}} X_2
\]</span> <span class="math display">\[
V(Z_1)=1.75,~~ V(Z_2)=0.25,~~ Cov(Z_1,Z_2) =0,~~  V(Z_1) + V(Z_2) = V(X_1) + V(X_2)=2
\]</span></p>
<p>참고할 점은 상관계수행렬의 대각의 합은 변수의 개수(<span class="math inline">\(p=2\)</span>)와 같고 상관계수가 변한다 하더라도 고유벡터들는 변하지 않아 주성분은 동일하게 정의되지만 각각의 분산은 달라진다. 아래는 상관계수 <span class="math inline">\(0.95\)</span>를 가지는 상관계수행렬의 고유치와 고유값이다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.95</span>,<span class="fl">0.95</span>,<span class="dv">1</span>),<span class="at">nrow=</span><span class="dv">2</span>) <span class="co"># 상관계수행렬(상관계수=0.95)</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>sigma</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,] 1.00 0.95
[2,] 0.95 1.00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">eigen</span>(sigma)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>eigen() decomposition
$values
[1] 1.95 0.05

$vectors
          [,1]       [,2]
[1,] 0.7071068 -0.7071068
[2,] 0.7071068  0.7071068</code></pre>
</div>
</div>
</section>
<section id="표본자료를-이용한-주성분분석" class="level3" data-number="6.1.4">
<h3 data-number="6.1.4" class="anchored" data-anchor-id="표본자료를-이용한-주성분분석"><span class="header-section-number">6.1.4</span> 표본자료를 이용한 주성분분석</h3>
<p>이변량 정규분포에서 <span class="math inline">\(n\)</span>개의 자료 <span class="math inline">\(\pmb  X_1, \pmb  X_2, \dots, \pmb  X_n\)</span>이 독립표본으로 추출되었다면 표본공분산과 표본상관계수를 추정하여 주성분을 만들 수 있다.</p>
<p><span class="math display">\[
\hat {\pmb  \Sigma } =
\begin{bmatrix}
\hat \sigma_{11} &amp; \hat \sigma_{12} \\
\hat  \sigma_{12} &amp; \hat \sigma_{22} \\
\end{bmatrix}
\quad
\hat{\pmb  C} =
\begin{bmatrix}
1 &amp; \hat \rho \\
\hat \rho &amp; 1 \\
\end{bmatrix}
\]</span></p>
<p>다음은 평균이 <span class="math inline">\(\pmb  0\)</span> 이고 다음을 공분산으로 가지는 이변량 정규분포에서 50개의 표본을 추출하고 표본상관계수를 추정하여 주성분을 만드는 <code>R</code> 프로그램이다. <span class="math display">\[
\pmb  \Sigma  =
\begin{bmatrix}
3 &amp; -2 \\
-2 &amp; 2 \\
\end{bmatrix}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)  <span class="co"># 평균 벡터</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">3</span>,<span class="sc">-</span><span class="dv">2</span>,<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>),<span class="at">nrow=</span><span class="dv">2</span>) <span class="co"># 공분산행렬</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">rmvnorm</span>(<span class="dv">100</span>,<span class="at">mean=</span>mu,<span class="at">sigma=</span>sigma)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(X)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           [,1]       [,2]
[1,]  4.6282705 -4.2243072
[2,]  1.4045731 -0.8958122
[3,]  0.4338715 -0.3901536
[4,]  0.9394071 -1.7978767
[5,] -2.1498722  1.7714280
[6,]  3.1633948 -1.8869771</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">cor</span>(X)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>C</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           [,1]       [,2]
[1,]  1.0000000 -0.8164816
[2,] -0.8164816  1.0000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">eigen</span>(C)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>eigen() decomposition
$values
[1] 1.8164816 0.1835184

$vectors
           [,1]       [,2]
[1,] -0.7071068 -0.7071068
[2,]  0.7071068 -0.7071068</code></pre>
</div>
</div>
<p>위의 결과로 주성분은 다음과 같이 주어진다.</p>
<p><span class="math display">\[
Z_1 = - 0.707 X_1 + 0.707 X_2 \quad Z_2 = - 0.707 X_1 - 0.707 X_2
\]</span></p>
<p>첫번째 주성분의 분산이 <span class="math inline">\(V(Z_1)=\lambda_1=1.816\)</span> 이므로 총변동 <span class="math inline">\(p=2\)</span> 의 91%를 설명한다.</p>
<p>원래 자료 <span class="math inline">\((X_1, X_2)\)</span>의 산점도와 위의 식에 원래 자료를 넣어 계산된 주성분의 값 <span class="math inline">\((Z_1,Z_2)\)</span> 산점도는 다음 그림과 같다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> <span class="fu">eigen</span>(C)<span class="sc">$</span>vectors</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">&lt;-</span> X <span class="sc">%*%</span> P</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(X, <span class="at">xlab=</span><span class="st">"X1"</span>,<span class="at">ylab=</span><span class="st">"X2"</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>,<span class="dv">4</span>),<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>,<span class="dv">4</span>))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">0</span>);<span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-pca_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Z, <span class="at">xlab=</span><span class="st">"Z1"</span>,<span class="at">ylab=</span><span class="st">"Z2"</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>,<span class="dv">4</span>),<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>,<span class="dv">4</span>))</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">0</span>);<span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-pca_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="주성분-분석의-기초이론" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="주성분-분석의-기초이론"><span class="header-section-number">6.2</span> 주성분 분석의 기초이론</h2>
<p>주성분분석은 서로 상관된 <span class="math inline">\(p\)</span> 개의 변수들 <span class="math inline">\(\pmb X=(X_1,X_2,\dots,X_p)^t\)</span>의 총 변동을 각 변수들의 선형결합으로 만든 서로 상관되지 않은 새로운 변수들인 <span class="math inline">\(\pmb Z^t=(Z_1,Z_2,\dots,Z_p)\)</span>에 의해 설명하는 것이다.</p>
<p><span class="math display">\[
Z_i = a_{i1} X_1 + a_{i2} X_2 + a_{i3} X_3 + \dots + a_{ip} X_p,\quad i=1,2,\dots,p
\]</span></p>
<p>주성분 분석의 목적은 원래의 관측변수들이 아닌 새로운 변수를 만들어서 원래 변수의 수보다 적은 수의 새로운 변수를 이용하여 원래 변수가 가지는 대부분의 변동을 설명하려는것이다. 즉, 차원의 축소(dimension reduction)가 그 목적이다.</p>
<p>새로운 변수인 <span class="math inline">\(Z_i\)</span>들을 주성분(principal component, PC)이라고 부르며 <span class="math inline">\(X_i\)</span>들의 모든 선형결합중에서 서로 상관되지 않고 원래 자료의 변동을 가능한 한 많이 설명한다는 의미에서 중요성이 감소하는 순서되로 유도된다.</p>
<p>즉 첫번째 주성분인 <span class="math inline">\(Z_1\)</span>은 다른 주성분보다 분산이 가장 크다. 다음으로 두번째 주성분 <span class="math inline">\(Z_2\)</span>는 <span class="math inline">\(Z_1\)</span>과 상관관계가 없으며 남아있는 변동을 가능한 한 많이 설명하게 만든다. 이러한 작업을 계속 적용하여 <span class="math inline">\(p\)</span>개의 주성분을 만들 수 있다.</p>
<p><span class="math display">\[
V(Z_1) \ge V(Z_2) \ge \dots \ge V(Z_p) \quad \text{ and } \quad Cov(Z_i, Z_j)=0,~~ i\ne j
\]</span></p>
<p>주성분 분석은 다음의 경우에 매우 우용하다.</p>
<ul>
<li>관측된 개수에 비하여 설명변수가 너무 많다.</li>
<li>설명변수들이 높게 상관되어 있다.</li>
</ul>
<section id="주성분의-정의" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="주성분의-정의"><span class="header-section-number">6.2.1</span> 주성분의 정의</h3>
<p><span class="math inline">\(\pmb X=(X_1, X_2,\dots,X_p)^t\)</span>를 차원이 <span class="math inline">\(p\)</span>인 확률벡터(random vector)라고 하자. <span class="math display">\[  E(\pmb X) = \pmb 0 \quad \text{and} \quad V(X)=\pmb \Sigma \]</span> 새로운 <span class="math inline">\(p\)</span>개의 주성분 <span class="math inline">\(\pmb Z=(Z_1,Z_2,\dots,Z_p)^t\)</span>는 <span class="math inline">\(X_i\)</span>들의 선형결합으로 만들어진다.</p>
<p><span id="eq-multivar-pca-pcdef"><span class="math display">\[
\begin{aligned}
Z_1 &amp;= \pmb a_1^t \pmb X = a_{11} X_1 + a_{12} X_2 + a_{13} X_3 + \dots + a_{1p} X_p  \\
Z_2 &amp;= \pmb a_2^t \pmb X = a_{21} X_1 + a_{22} X_2 + a_{23} X_3 + \dots + a_{2p} X_p  \\
Z_3 &amp;= \pmb a_3^t \pmb X = a_{31} X_1 + a_{32} X_2 + a_{33} X_3 + \dots + a_{3p} X_p  \\
    &amp; \dots &amp; \\
Z_p &amp;= \pmb a_p^t \pmb X = a_{p1} X_1 + a_{p2} X_2 + a_{p3} X_3 + \dots + a_{pp} X_p  \\
\end{aligned}
\tag{6.6}\]</span></span></p>
<p><a href="#eq-multivar-pca-pcdef" class="quarto-xref">식&nbsp;<span>6.6</span></a> 에서 정의된 주성분은 다음과 같은 통계적 성질을 가지고 있다.</p>
<p><span class="math display">\[
E(Z_i) = \pmb a_i^t \pmb 0= \pmb 0 \quad \text{and} \quad V(Z_i)= \pmb a_i^t \pmb \Sigma \pmb a_i
\quad \text{and} \quad Cov(Z_i,Z_j)= \pmb a_i^t \pmb \Sigma \pmb a_j
\]</span></p>
<p>만약 주성분을 만드는 계수 벡터 <span class="math inline">\(\pmb a_i\)</span>들을 다음과 같이 행렬로 표시하면</p>
<p><span id="eq-multivar-pca-coefmat"><span class="math display">\[
\pmb A =
\begin{bmatrix}
a_{11} &amp; a_{12} &amp; \dots &amp; a_{1p} \\
a_{21} &amp; a_{22} &amp; \dots &amp; a_{2p} \\
       &amp; \dots &amp; \dots           \\
a_{p1} &amp; a_{p2} &amp; \dots &amp; a_{pp} \\
\end{bmatrix}
=
\begin{bmatrix}
\pmb a_1^t \\
\pmb a_2^t \\
\dots \\
\pmb a_1^t \\
\end{bmatrix}
\tag{6.7}\]</span></span></p>
<p><a href="#eq-multivar-pca-pcdef" class="quarto-xref">식&nbsp;<span>6.6</span></a> 의 주성분 벡터 <span class="math inline">\(\pmb Z\)</span>는 다음과 같이 정의된다.</p>
<p><span id="eq-multivar-pca-pcdef2"><span class="math display">\[
\pmb Z = \pmb A  \pmb X
\tag{6.8}\]</span></span></p>
<p>이제 주성분을 만드는 절차는 다음과 같다.</p>
<p>1.첫번쨰 주성분 <span class="math inline">\(Z_1 = \pmb a_1^t \pmb X\)</span> 를 다음과 같은 조건이 만족하게 찾는다.</p>
<ul>
<li>Maximize <span class="math inline">\(Var(Z_1)= \pmb a_1^t \pmb \Sigma \pmb a_1\)</span></li>
<li>subject to <span class="math inline">\(\pmb a_1^t \pmb a_1=1\)</span>, i,e,</li>
</ul>
<p><span class="math display">\[
a_{11}^2 + a_{12}^2 + a_{13}^2 + \cdots + a_{1p}^2=1  
\]</span></p>
<ol start="2" type="1">
<li>두번쨰 주성분 <span class="math inline">\(Z_2 = \pmb a_2^t \pmb X\)</span> 다음과 같은 조건이 만족하게 찾는다.</li>
</ol>
<ul>
<li>Maximize <span class="math inline">\(Var(Z_2)= \pmb a_2^t \pmb \Sigma \pmb a_2\)</span></li>
<li>subject to <span class="math inline">\(a_{21}^2 + a_{22}^2 + \dots + a_{2p}^2=1\)</span></li>
<li><span class="math inline">\(Z_2\)</span> is uncorrelated with <span class="math inline">\(Z_1\)</span>, i.e.</li>
</ul>
<p><span class="math display">\[
Cov(Z_1,Z_2)= \pmb a_1^t \pmb \Sigma \pmb a_2=0
\]</span></p>
<p>….</p>
<ol start="11" type="a">
<li><span class="math inline">\(k\)</span> 번째 주성분 <span class="math inline">\(Z_k = \pmb a_k^t  \pmb X\)</span> 다음과 같은 조건이 만족하게 찾는다.</li>
</ol>
<ul>
<li>Maximize <span class="math inline">\(Var(Z_k)= \pmb a_k^t \pmb \Sigma \pmb a_k\)</span></li>
<li>subject to <span class="math inline">\(a_{k1}^2 + a_{k2}^2 + \dots + a_{kp}^2=1\)</span></li>
<li><span class="math inline">\(Z_k\)</span> is uncorrelated with <span class="math inline">\(Z_1,Z_2,\dots,Z_{k-1}\)</span>,</li>
</ul>
<p><span class="math display">\[
Cov(Z_k,Z_i)= \pmb a_k^t \pmb \Sigma \pmb a_i=0 \quad \text{ for } \quad i=1,2,\dots,k-1
\]</span> 주성분의 계수를 찾을 때 실제로는 공분산행렬 <span class="math inline">\(\pmb \Sigma\)</span>을 모르기 때문에 표본으로부터 얻어진 표본 공분산행렬 <span class="math inline">\(\hat {\pmb \Sigma} \equiv \pmb S\)</span>를 이용한다. 또는 표본 상관계수행렬 <span class="math inline">\(\hat {\pmb C}\)</span>를 이용한다.</p>
</section>
<section id="양정치-행렬의-스펙트럼분해" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="양정치-행렬의-스펙트럼분해"><span class="header-section-number">6.2.2</span> 양정치 행렬의 스펙트럼분해</h3>
<p>주성분분석에서 선형결합에 이용되는 계수 <span class="math inline">\(a_{ij}\)</span>는 공분산행렬의 스펙트럼 분해(Spectral Decomposition)을 통하여 찾을 수 있다 (<a href="math_eigen_value.html#eq-multivar-app-eigen-spectral" class="quarto-xref">식&nbsp;<span>B.4</span></a> 참조).</p>
<p>공분산행렬은 대칭인 양정치행렬(positive definite matrix)이기 때문에 양의 실수를 가지는 고유값(eigenvalues)을 가진다. <span class="math inline">\(p \times p\)</span> 공분산 행렬을 <span class="math inline">\(\pmb \Sigma\)</span>라하면 다음과 같은 스펙트럼 분해가 가능하다.</p>
<p><span class="math display">\[
\pmb \Sigma = \pmb P \pmb \Lambda \pmb P^t
\]</span> 여기서 <span class="math inline">\(\pmb \Lambda=diag(\lambda_1,\lambda_2,\dots,\lambda_q)\)</span>는 대각원소가 공분산행렬의 고유값인 대각행렬이며 고유값은 다음과 같이 내림차순으로 정렬되어 있다고 하자.</p>
<p><span class="math display">\[
\lambda_1 \ge\lambda_2 \ge \dots \ge \lambda_p
\]</span></p>
<p>행렬 <span class="math inline">\(\pmb P\)</span>는 <span class="math inline">\(p \times p\)</span> 직교행렬(orthonomal matrix)로서 <span class="math inline">\(k\)</span>번째 열벡터 <span class="math inline">\(\pmb a_k\)</span>는 <span class="math inline">\(k\)</span> 번째 고유값에 해당하는 고유벡터이다.</p>
<p><span class="math display">\[
\pmb \Sigma \pmb a_k = \lambda_k \pmb a_k \quad \text{and} \quad  a_{k1}^2 + a_{k2}^2 + \dots + a_{kp}^2=1, \quad k=1,2,\dots,p
\]</span></p>
<p><span class="math display">\[
\pmb P = [ \pmb a_1~~ \pmb a_2~~ \dots~~ \pmb a_p ]
\]</span></p>
<p>여기서 행렬 <span class="math inline">\(\pmb P\)</span>는 직교행렬이므로 각 고유벡터들은 다음과 같은 관계가 있다.</p>
<p><span class="math display">\[
\begin{cases}
\pmb a_i^t \pmb a_j = 0 &amp; \text{if }~~ i \ne j \\
\pmb a_i^t \pmb a_i = 1 &amp; \text{if }~~ i = j
\end{cases}
\]</span></p>
</section>
<section id="이차형식의-최대값" class="level3" data-number="6.2.3">
<h3 data-number="6.2.3" class="anchored" data-anchor-id="이차형식의-최대값"><span class="header-section-number">6.2.3</span> 이차형식의 최대값</h3>
<p>주어진 대칭인 양정치행렬 <span class="math inline">\(\pmb \Sigma\)</span>에 대하여 다음과 같이 2차형식(quadratic form) <span class="math inline">\(\pmb x^t \Sigma \pmb x\)</span>의 값을 최대로 하는 <span class="math inline">\(p\)</span>-차원의 벡터 <span class="math inline">\(\pmb x\)</span>를 찾는 문제를 풀어보자.</p>
<p><span class="math display">\[
\max_{\pmb x} \frac{\pmb x^t \pmb \Sigma \pmb x}{\pmb x^t \pmb x} = \max_{\pmb x; | \pmb x|=1} \pmb x^t \pmb \Sigma \pmb x
\]</span> 위의 문제에서 2차형식 <span class="math inline">\(\pmb x^t \pmb \Sigma \pmb x\)</span>는 벡터 <span class="math inline">\(\pmb x\)</span>의 길이를 증가시키면 비례하여 증가하므로 이차형식을 벡터의 길이의 제곱 <span class="math inline">\(\pmb x^t \pmb x\)</span>로 나누어 표준화시킨 다음 그 양을 최대화하는 벡터를 찾는 문제로 생각하는 것이다.</p>
<p>2차형식(quadratic form) <span class="math inline">\(\pmb x^t \pmb \Sigma \pmb x\)</span>은 다음과 같은 스펙트럼분해가 가능하다. <span class="math display">\[
\pmb x^t \pmb \Sigma \pmb x= \pmb x^t \pmb P \pmb \Lambda \pmb P^t x = \pmb x^t [ \pmb a_1~~ \pmb a_2~~ \dots ~~\pmb  a_p ]
\begin{bmatrix}
\lambda_1 &amp; 0 &amp; \dots &amp; 0 \\
0 &amp; \lambda_2 &amp; \dots &amp; 0 \\
\dots &amp; \dots &amp; \dots &amp; \dots \\
0 &amp; 0 &amp; \dots &amp; \lambda_p \\
\end{bmatrix}
[ \pmb a_1~~ \pmb a_2~~ \dots ~~\pmb a_p ]^t \pmb x
\]</span></p>
<p>새로운 변수 <span class="math inline">\(\pmb z= \pmb P^t \pmb x\)</span>를 정의하면 2차형식은 다음과 같이 표시된다.</p>
<p><span class="math display">\[
\pmb x^t \pmb \Sigma \pmb x = \pmb z^t  \pmb \Lambda \pmb z = \lambda_1  z_1^2 + \lambda_2 z_2^2 + \dots \lambda_p z_p^2
\]</span> 고유값은 다음과 같은 관계를 가지므로</p>
<p><span class="math display">\[
\lambda_1 \ge\lambda_2 \ge \dots \ge \lambda_p
\]</span> 다음과 같은 부등식을 얻을 수 있으며</p>
<p><span class="math display">\[  
\lambda_p \sum_{i=1}^p z_i^2 \le  \sum_{i=1}^p  \lambda_i z_i^2 \le \lambda_1 \sum_{i=1}^p z_i^2
\]</span> 다시 위의 부등식에서 모든 항을 <span class="math inline">\(\pmb z^t \pmb z = \sum_{i=1}^p \pmb z_i^2\)</span>으로 나누면 다음의 부등식을 얻는다.</p>
<p><span class="math display">\[
\lambda_p  \le  \frac{\sum_{i=1}^p  \lambda_i z_i^2}{\sum_{i=1}^p z_i^2} \le \lambda_1
\]</span></p>
<p>또한 <span class="math inline">\(\pmb z^t \pmb z = \pmb x^t \pmb P \pmb P^t \pmb x^t=\pmb x^t \pmb x\)</span>으므로 마지막으로 아래의 부등식을 얻는다.</p>
<p><span class="math display">\[
\lambda_p  \le  \frac{\pmb x^t \pmb \Sigma \pmb x}{\pmb x^t \pmb x} \le \lambda_1
\]</span> 이 부등식의 의미는 표준화된 2차형식의 최대값은 가장 큰 고유값이며 최소값은 가장 작은 고유값이다.</p>
</section>
<section id="주성분의-계수" class="level3" data-number="6.2.4">
<h3 data-number="6.2.4" class="anchored" data-anchor-id="주성분의-계수"><span class="header-section-number">6.2.4</span> 주성분의 계수</h3>
<p><span class="math inline">\(p\)</span>-차원의 벡터 <span class="math inline">\(\pmb a\)</span>의 선형결합으로 새로운 변수 <span class="math inline">\(Z_1= \pmb a^t \pmb X\)</span>를 고려할때 <span class="math inline">\(Z_1\)</span>의 분산은 다음과 같다.</p>
<p><span class="math display">\[
Var(Z_1) = Var( \pmb a^t \pmb X) = \pmb a^t Var(\pmb X) \pmb a = \pmb a^t \pmb \Sigma \pmb a
\]</span> 위에서 얻은 이차형식의 최대값을 구하는 과정을 보면 선형결합의 계수 <span class="math inline">\(\pmb a\)</span>를 공분산행렬에 대한 가장 큰 고유값 <span class="math inline">\(\lambda_1\)</span>에 해당하는 표준고유벡터 <span class="math inline">\(\pmb a_1\)</span> 를 사용하면 <span class="math inline">\(Z_1\)</span>의 분산을 최대화 할 수 있다.</p>
<p><span class="math display">\[
Var(Z_1) = Var( \pmb a_1^t \pmb X) = \pmb a_1^t \pmb \Sigma \pmb a_1 = \pmb a_1^t (\lambda_1 \pmb a_1) = \lambda_1 \]</span></p>
<p>이렇게 첫 번째 주성분 <span class="math inline">\(Z_1 = \pmb a_1^t \pmb X\)</span> 을 찾을 수 있으며 두 번째 주성분, 세 번째 주성분들도 유사한 방법을 통해 찾아나간다. 두번째 주성분은 공분산행렬에 대한 두 번째로 큰 고유값 <span class="math inline">\(\lambda_2\)</span>에 해당하는 표준 고유벡터 <span class="math inline">\(\pmb a_2\)</span>로 사용하면 그 분산은 <span class="math inline">\(\lambda_2\)</span>이고 첫 번째 주성분과의 상관관계는 0이다.</p>
<p><span class="math display">\[
Var(Z_2) = Var(\pmb a_2^t \pmb X) = \pmb a_2^t Var(\pmb X) \pmb a_2 = \lambda_2
\]</span> <span class="math display">\[
Cov(Z_1,Z_2) = Cov(\pmb a_1^t \pmb X, \pmb a_2^t \pmb X) = \pmb a_1^t Cov(\pmb X) \pmb a_2 =
\pmb a_1^t \pmb P \pmb \Lambda \pmb P^t \pmb a_2 =0
\]</span></p>
<p>따라서 주성분분석에서 <span class="math inline">\(i\)</span>번째 주성분의 계수는 공분산행렬 <span class="math inline">\(\pmb \Sigma\)</span>의 고유값 중 <span class="math inline">\(i\)</span> 번째 큰 값인 <span class="math inline">\(\lambda_i\)</span>에 해당하는 고유벡터 <span class="math inline">\(\pmb a_i\)</span>로 놓는다.</p>
<p><span class="math display">\[
Z_i = \pmb a_i^t \pmb X ,\quad i=1,2,\dots,p
\]</span></p>
</section>
<section id="공분산행렬과-상관계수행렬" class="level3" data-number="6.2.5">
<h3 data-number="6.2.5" class="anchored" data-anchor-id="공분산행렬과-상관계수행렬"><span class="header-section-number">6.2.5</span> 공분산행렬과 상관계수행렬</h3>
<p>앞절에서 설명한 바와 같이 주성분을 반드는 경우 공분산행렬(Covariance matrix)를 사용하면 원래 변수의 단위가 바뀌면 주성분의 계수도 영향을 받는다. 변수들 중 분산이 큰 변수가 있으면 그 변수에 해당하는 주성분의 계수가 커지는 현상이 발생한다.</p>
<p>이러한 단점을 보완하기 위하여 보통의 경우 주성분은 공분산행렬이 아닌 상관계수행렬 <span class="math inline">\(\pmb C\)</span> (Correlation matrix)의 고유값과 고유벡터를 이용하여 주성분을 만든다.</p>
<p>앞에서 전개한 주성분분석의 이론은 공분산행렬 <span class="math inline">\(\pmb \Sigma\)</span>를 상관계수행렬 <span class="math inline">\(\pmb C\)</span> 로 바꾸어 전개하면 된다. 주의할 점은 상관계수행렬을 이용하는 경우 모든 대각원소가 1으므로 총변동은 변수의 개수 <span class="math inline">\(p\)</span>가 된다.</p>
<p><span class="math display">\[
\sum_{i=1}^p V(X_i) = \sum_{i=1}^p V(Z_i) = trace( \pmb C) = p  
\]</span></p>
</section>
</section>
<section id="주성분-분석" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="주성분-분석"><span class="header-section-number">6.3</span> 주성분 분석</h2>
<section id="주성분-개수의-선택" class="level3" data-number="6.3.1">
<h3 data-number="6.3.1" class="anchored" data-anchor-id="주성분-개수의-선택"><span class="header-section-number">6.3.1</span> 주성분 개수의 선택</h3>
<p>주성분은 변수들의 모든 선형결합중에서 서로 상관되지 않고 원래 자료의 변동을 가능한 한 많이 설명한다는 의미에서 성분의 중요성이 감소하는 순서되로 유도된다. 따라서 주성분 분석의 목적에 따라 원래의 변수 개수인 <span class="math inline">\(p\)</span>보다 적은 개수의 주성분들을 선택하여 원래 변수가 가지고 있는 변동의 많은 부분을 설명하려고 한다.</p>
<p>문제는 몇 개의 주성분을 선택해야 하는 문제이다.</p>
<p>각 주성분의 분산은 공분산 <span class="math inline">\(\pmb  \Sigma\)</span>의 고유값이고 그 고유값들은 다음과 같은 순서로 정렬되어 있다</p>
<p><span class="math display">\[
\lambda_1 \ge\lambda_2 \ge \dots \ge \lambda_p
\]</span></p>
<p>따라서 원래 변수 <span class="math inline">\(X_1,X_2,\dots,X_p\)</span>들의 분산의 합은 모든 고유값의 합과 같다.</p>
<p><span class="math display">\[
\sum_{i=1}^p Var(X_i) =\sum_{i=1}^p \sigma_{ii} = \sum_{i=1}^p \lambda_i = \sum_{i=1}^p Var(Z_i)
\]</span></p>
<p>이는 다음과 같은 식에서 유도 된다.</p>
<p><span class="math display">\[
trace(\pmb  \Sigma) = trace(\pmb  P \pmb  \Lambda \pmb  P^t) =trace( \pmb  \Lambda \pmb  P^t \pmb  P)= trace( \pmb  \Lambda)
\]</span></p>
<p>따라서 주성분 <span class="math inline">\(Z_i\)</span>는 자료의 총변동 <span class="math inline">\(\sum_{i=1}^p \lambda_i =trace(\pmb  \Sigma)\)</span>를 다음과 같은 비율만큼 설명한다.</p>
<p><span id="eq-multivar-pca-proportion"><span class="math display">\[
P_i = \frac{\lambda_i}{\sum_{j=1}^p \lambda_j}
\tag{6.9}\]</span></span></p>
<p>그리고 만약 <span class="math inline">\(m&lt;p\)</span>개의 주성분 <span class="math inline">\(Z_1,Z_2,\dots,Z_m\)</span> 을 선택했다면 자료의 총변동을 다음과 같은 비율만큼 설명한다.</p>
<p><span id="eq-multivar-pca-varratio"><span class="math display">\[
P_1+P_2+\dots+P_m = \frac{\lambda_1+\lambda_2+\dots + \lambda_m}{\sum_{j=1}^p \lambda_j}
\tag{6.10}\]</span></span></p>
<p>주성분의 개수를 선택하는 방법은 매우 다양하며 다음과 같은 몇 개의 절차가 일번적인 방법이다.</p>
<ul>
<li>총변동의 70%에서 90%를 설명할 수 있게 주성분의 개수를 선택</li>
</ul>
<p><span class="math display">\[ 0.7 \le P_1+P_2+\dots+P_m \le 0.9 \]</span></p>
<ul>
<li><p>평균고유값 <span class="math inline">\(\sum_{i=1}^p \lambda_i /p\)</span>보다 작은 분산을 가지는 주성분을 제외한다.</p></li>
<li><p>주성분이 상관행렬로부터 추출되는 경우 고유값이 1보다 작은 주성분을 제외한다.</p></li>
<li><p>Scree diagram을 이용: Scree diagram은 고유값을 큰 순서대로 그림으로 그리고 선을 연결항 그래프이다. 고유값의 감소가 느리게 진행되는 때까지 큰 고유치를 선택하면 된다.</p></li>
</ul>
</section>
<section id="주성분의-척도변경" class="level3" data-number="6.3.2">
<h3 data-number="6.3.2" class="anchored" data-anchor-id="주성분의-척도변경"><span class="header-section-number">6.3.2</span> 주성분의 척도변경</h3>
<p>원래의 변수벡터 <span class="math inline">\(\pmb  X\)</span>와 주성분 <span class="math inline">\(Z_j\)</span>의 공분산은 다음과 같다.</p>
<p><span class="math display">\[ Cov(\pmb  X, Z_j) =Cov(\pmb  X, \pmb  a_j^t \pmb  X) = Cov(\pmb  X, \pmb  X^t )\pmb  a_j = \pmb  \Sigma \pmb  a_j \]</span></p>
<p>고유벡터 <span class="math inline">\(\pmb  a_j\)</span>의 성질은 $ a_j =_j a_j$이므로 다음과 같은 결과를 얻고</p>
<p><span class="math display">\[
Cov(\pmb  X , Z_j) = \pmb  \Sigma \pmb  a_j =\lambda_j \pmb  a_j
\]</span></p>
<p>따라서 원래의 변수 <span class="math inline">\(X_i\)</span>와 주성분 <span class="math inline">\(Z_j\)</span>의 공분산은 다음과 같다.</p>
<p><span class="math display">\[
Cov(X_i, Z_j) = \lambda_j  a_{ji}
\]</span> 더 나아가 원래의 변수 <span class="math inline">\(X_i\)</span>와 주성분 <span class="math inline">\(Z_j\)</span>의 상관계수는 다음과 같다.</p>
<p><span class="math display">\[ Corr(X_i, Z_j) = \frac{Cov(X_i, Z_j)} {\sqrt{Var(X_i) Var(Z_j)}}
=  \frac{\lambda_j a_{ji}} {\sqrt{\sigma_{ii} \lambda_j}}
=\frac{\sqrt{\lambda_j} a_{ji}} {\sqrt{\sigma_{ii} }}
\]</span></p>
<p>만약 주성분이 상관계수 행렬에서 얻어졌다면 <span class="math inline">\(\sigma_{ii}=1\)</span>이므로</p>
<p><span class="math display">\[
Corr(X_i, Z_j) = \sqrt{\lambda_j} a_{ji}
\]</span></p>
<p>따라서 주성분을 만드는 경우 주성분의 표준 편차 <span class="math inline">\(\sqrt{\lambda_j}\)</span> 으로 나누어 주면 원래 자료와의 공분산이 주성분변환의 계수로 나오게 된다.</p>
<p><span class="math display">\[ Cov \left ( X_i, \tfrac{Z_j}{\sqrt{\lambda_j}} \right ) =  a_{ji} \]</span></p>
</section>
<section id="주성분-점수" class="level3" data-number="6.3.3">
<h3 data-number="6.3.3" class="anchored" data-anchor-id="주성분-점수"><span class="header-section-number">6.3.3</span> 주성분 점수</h3>
<p>자료의 변동을 설명하기 위하여 <span class="math inline">\(m\)</span>개의 주성분이 필요하다면 각 표본의 개체에 대한 새로운 주성분의 값을 구할 수 있다. 이를 주성분 점수(Principal Component score)라고 한다.</p>
<p><span class="math inline">\(p\)</span>개의 변수를 가지는 확률벡터를 독립적으로 <span class="math inline">\(n\)</span>개 표본추출했다고 하자. <span class="math inline">\(X_{ij}\)</span>는 <span class="math inline">\(i\)</span>번째 표본의 <span class="math inline">\(j\)</span>번째 변수이라고 하면 <span class="math inline">\(i\)</span>번째 개체의 관측벡터는 <span class="math inline">\(\pmb  X_i\)</span>는 다음과 같다.</p>
<p><span class="math display">\[ \pmb  X_i=(X_{i1},X_{i2},\dots,X_{ip})^t \]</span> <span class="math inline">\(j\)</span>번째 변수의 표본 평균을 <span class="math inline">\(\bar X_j = \sum_{i=1}^n X_{ij}/n\)</span> 으로 정의하고 추출된 표본의 평균벡터를 <span class="math inline">\(\bar {\pmb  X}\)</span>를 다음과 같다고 하자.</p>
<p><span class="math display">\[
\bar {\pmb  X}  = (\bar X_1,\bar X_2,\dots,\bar X_p)^t
\]</span></p>
<p>이제 각 관측값을 해당하는 변수의 평균으로 빼준 벡터 <span class="math inline">\(\pmb  Y_i\)</span> 를 고려하자.</p>
<p><span class="math display">\[
\pmb  Y_i = \pmb  X_i - \bar {\pmb  X} =(X_{i1}- \bar X_1 ,X_{i2}-\bar X_2,\dots,X_{ip}-\bar X_p)^t
\]</span></p>
<p>이제 <span class="math inline">\(i\)</span>번째 개체의 <span class="math inline">\(j\)</span> 번째 주성분 점수는 다음과 같이 정의된다.</p>
<p><span id="eq-multivar-pca-pcscores"><span class="math display">\[  
Z_{ij} =  \pmb  a_j^t \pmb  Y_i = \sum_{k=1}^p a_{jk} Y_{ik} = \sum_{k=1}^p a_{jk} (X_{ik} - \bar X_k)
\tag{6.11}\]</span></span></p>
<p>주성분 점수는 각각 관측된 개체가 원래 <span class="math inline">\(p\)</span>개의 변수를 가지고 있다면 주성분분석을 통해서 더 적은 수, <span class="math inline">\(m&lt;p\)</span>개의 새로운 변수로서 관측 변수의 개수를 축소했다고 생각하면 된다.</p>
<p><span class="math display">\[
\pmb  Z_i=(Z_{i1},Z_{i2},\dots,Z_{im})^t
\]</span></p>
</section>
</section>
<section id="예제-올림픽-7종-경기-자료" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="예제-올림픽-7종-경기-자료"><span class="header-section-number">6.4</span> 예제: 올림픽 7종 경기 자료</h2>
<p>올림픽 7종 경기 자료에 주성분분석을 적용해보자. 7종 경기의 종목은 100m 허들, 높이뛰기, 투포환, 200m 달리기, 멀리뛰기, 창던지기, 800m달리기이다. 순위는 혼성 경기 득점표에 따라 각 종목의 종합 득점으로 정한다.</p>
<p>올림픽 7종 경기 자료는 다음과 같이 불러올 수 있다. 25명의 선수들에 대한 7개의 종목의 기록과 총점(<code>score</code>)으로 구성된 자료이다. 마지막 변수 <code>score</code> 는 올림픽 위원회가 7개의 종목의 기록을 결합해서 만든 점수로서 메달의 순위를 결정한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(HSAUR2)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>df_1 <span class="ot">&lt;-</span> heptathlon</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df_1)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 25  8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df_1)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hurdles"  "highjump" "shot"     "run200m"  "longjump" "javelin"  "run800m" 
[8] "score"   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_1)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    hurdles highjump  shot run200m longjump javelin run800m
Joyner-Kersee (USA)   12.69     1.86 15.80   22.56     7.27   45.66  128.51
John (GDR)            12.85     1.80 16.23   23.65     6.71   42.56  126.12
Behmer (GDR)          13.20     1.83 14.20   23.10     6.68   44.54  124.20
Sablovskaite (URS)    13.61     1.80 15.23   23.92     6.25   42.78  132.24
Choubenkova (URS)     13.51     1.74 14.76   23.93     6.32   47.46  127.90
Schulz (GDR)          13.75     1.83 13.50   24.65     6.33   42.82  125.79
                    score
Joyner-Kersee (USA)  7291
John (GDR)           6897
Behmer (GDR)         6858
Sablovskaite (URS)   6540
Choubenkova (URS)    6540
Schulz (GDR)         6411</code></pre>
</div>
</div>
<p>먼저 7개의 자료의 값이 크기가 크면 좋은 기록이 나타내도록 변환을 한다. 따라서 육상경기 변수는 각 관측값을 그 변수의 최대값에서 빼준다. 또한 파푸아뉴기니아 선수가 너무 실력이 떨어져서 이상치로 분류하여 분석에서 제외한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>df_1<span class="sc">$</span>hurdles <span class="ot">&lt;-</span> <span class="fu">with</span>(df_1, <span class="fu">max</span>(hurdles)<span class="sc">-</span>hurdles)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>df_1<span class="sc">$</span>run200m <span class="ot">&lt;-</span> <span class="fu">with</span>(df_1, <span class="fu">max</span>(run200m)<span class="sc">-</span>run200m)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>df_1<span class="sc">$</span>run800m <span class="ot">&lt;-</span> <span class="fu">with</span>(df_1, <span class="fu">max</span>(run800m)<span class="sc">-</span>run800m)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>df_1 <span class="ot">&lt;-</span> df_1 <span class="sc">%&gt;%</span> </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(<span class="fu">rownames</span>(.), <span class="st">"PNG"</span>))</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df_1)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 24  8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_1)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    hurdles highjump  shot run200m longjump javelin run800m
Joyner-Kersee (USA)    3.73     1.86 15.80    4.05     7.27   45.66   34.92
John (GDR)             3.57     1.80 16.23    2.96     6.71   42.56   37.31
Behmer (GDR)           3.22     1.83 14.20    3.51     6.68   44.54   39.23
Sablovskaite (URS)     2.81     1.80 15.23    2.69     6.25   42.78   31.19
Choubenkova (URS)      2.91     1.74 14.76    2.68     6.32   47.46   35.53
Schulz (GDR)           2.67     1.83 13.50    1.96     6.33   42.82   37.64
                    score
Joyner-Kersee (USA)  7291
John (GDR)           6897
Behmer (GDR)         6858
Sablovskaite (URS)   6540
Choubenkova (URS)    6540
Schulz (GDR)         6411</code></pre>
</div>
</div>
<p>먼저 7개 변수의 상관관계를 보자</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df_1_t <span class="ot">&lt;-</span> df_1 <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(<span class="sc">-</span>score)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(df_1_t)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           hurdles  highjump      shot   run200m  longjump   javelin   run800m
hurdles  1.0000000 0.5817409 0.7666860 0.8300371 0.8893472 0.3324779 0.5587794
highjump 0.5817409 1.0000000 0.4646854 0.3909024 0.6626910 0.3480793 0.1523350
shot     0.7666860 0.4646854 1.0000000 0.6694330 0.7840380 0.3430333 0.4082925
run200m  0.8300371 0.3909024 0.6694330 1.0000000 0.8106176 0.4707969 0.5731902
longjump 0.8893472 0.6626910 0.7840380 0.8106176 1.0000000 0.2870826 0.5233809
javelin  0.3324779 0.3480793 0.3430333 0.4707969 0.2870826 1.0000000 0.2559348
run800m  0.5587794 0.1523350 0.4082925 0.5731902 0.5233809 0.2559348 1.0000000</code></pre>
</div>
</div>
<p>주성분 분석은 함수 <code>princomp</code> 를 사용한다. 맨 마지막 8번째 변수 <code>score</code> 를 제외한 7개의 변수로 주성분분석을 실시하자. 함수 <code>princomp</code> 에서 선택문 <code>cor = TRUE</code> 는 상관계수행렬로 주성분분석을 실행하라는 선택이며 함수 <code>summary</code> 에서 <code>loadings = TRUE</code> 는 주성분의 계수를 보여주라는 것이다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>pca1 <span class="ot">&lt;-</span> <span class="fu">princomp</span>(df_1_t, <span class="at">cor =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pca1,<span class="at">loadings =</span> <span class="cn">TRUE</span>)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Importance of components:
                          Comp.1    Comp.2    Comp.3     Comp.4     Comp.5
Standard deviation     2.0793370 0.9481532 0.9109016 0.68319667 0.54618878
Proportion of Variance 0.6176632 0.1284278 0.1185345 0.06667967 0.04261745
Cumulative Proportion  0.6176632 0.7460909 0.8646255 0.93130515 0.97392260
                           Comp.6      Comp.7
Standard deviation     0.33745486 0.262042024
Proportion of Variance 0.01626797 0.009809432
Cumulative Proportion  0.99019057 1.000000000

Loadings:
         Comp.1 Comp.2 Comp.3 Comp.4 Comp.5 Comp.6 Comp.7
hurdles   0.450         0.174         0.199  0.847       
highjump  0.315 -0.651  0.209 -0.557               -0.332
shot      0.402         0.153  0.548 -0.672        -0.229
run200m   0.427  0.185 -0.130  0.231  0.618 -0.333 -0.470
longjump  0.451         0.270         0.122 -0.383  0.749
javelin   0.242 -0.326 -0.881                       0.211
run800m   0.303  0.657 -0.193 -0.574 -0.319              </code></pre>
</div>
</div>
<p>주성분 분석의 결과를 다음과 같이 해석할 수 있다.</p>
<ul>
<li><p>주성분 2개를 선택하면 총변동의 76 % 를 설명하고 3개를 선택하면 86 % 를 설명한다.</p>
<ul>
<li><code>Proportion of Variance</code> 은 <a href="#eq-multivar-pca-proportion" class="quarto-xref">식&nbsp;<span>6.9</span></a> 에서 정의된 <span class="math inline">\(P_i\)</span>의 값을 나타낸다.</li>
<li><code>Cumulative Proportion</code> <a href="#eq-multivar-pca-varratio" class="quarto-xref">식&nbsp;<span>6.10</span></a> 의 <span class="math inline">\(P_i\)</span> 이 누적합을 나타낸다.</li>
</ul></li>
<li><p>먼저, 계수의 값이 없는 이유는 상대적으로 작은 값은 제시하지 않아서 이다</p></li>
<li><p>첫번째 주성분(<code>Comp.1</code>)의 계수를 보면 각 종목 점수의 가중평균과 유사하다.</p></li>
<li><p>두 번째 주성분(<code>Comp.2</code>)은 800달리기와 높이뛰기의 차이로 해석된다(각각의 계수가 다른 변수에 비해 절상대적으로 크고 부호가 반대이다).</p></li>
<li><p>3번째 주성분(<code>Comp.3</code>)은 창던지기(javelin)의 능력을 나타내는것으로 해석된다.</p></li>
</ul>
<p>주성분 개수의 선택에 이용되는 scree plot은 다음과 같다. 막대의 높이는 주성분의 분산, 즉 고유치와 비례한다</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca1, <span class="at">main =</span> <span class="st">"scree plot"</span>)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-pca_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>25명의 선수에 대한 <a href="#eq-multivar-pca-pcscores" class="quarto-xref">식&nbsp;<span>6.11</span></a> 에 의한 주성분 점수를 구할 수 있고 첫번째와 두번째 주성분 점수를 산점도로 그려보았다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pca1<span class="sc">$</span>scores)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       Comp.1     Comp.2       Comp.3     Comp.4     Comp.5
Joyner-Kersee (USA) 4.8598544 -0.1428696  0.006170444  0.2997271  0.3696153
John (GDR)          3.2156489  0.9689924  0.249166030  0.5609829 -0.7698539
Behmer (GDR)        2.9891207  0.7102977 -0.635677626 -0.5666763  0.1944444
Sablovskaite (URS)  1.3158405  0.1828572 -0.256022940  0.6508784 -0.6166041
Choubenkova (URS)   1.5357870  0.9824589 -1.818885157  0.8008982 -0.6023826
Schulz (GDR)        0.9790817  0.3587703 -0.421970960 -1.1374969 -0.7302135
                         Comp.6      Comp.7
Joyner-Kersee (USA) -0.27632076  0.48611032
John (GDR)           0.38582368  0.05283965
Behmer (GDR)        -0.26334765 -0.11292729
Sablovskaite (URS)  -0.22039763 -0.54216684
Choubenkova (URS)    0.08186703  0.30728837
Schulz (GDR)        -0.25984050 -0.03921361</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>df_pca <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(pca1<span class="sc">$</span>scores)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>df_pca <span class="ot">&lt;-</span> df_pca <span class="sc">%&gt;%</span> </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"label"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df_1 <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>(<span class="st">"label"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(label, score), <span class="at">by=</span><span class="st">"label"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">as.integer</span>(<span class="fu">rank</span>(<span class="sc">-</span>score))) <span class="sc">%&gt;%</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">paste0</span>(label, <span class="st">"("</span>, rank, <span class="st">")"</span>))</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_pca)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   label    Comp.1     Comp.2       Comp.3     Comp.4
1 Joyner-Kersee (USA)(1) 4.8598544 -0.1428696  0.006170444  0.2997271
2          John (GDR)(2) 3.2156489  0.9689924  0.249166030  0.5609829
3        Behmer (GDR)(3) 2.9891207  0.7102977 -0.635677626 -0.5666763
4  Sablovskaite (URS)(4) 1.3158405  0.1828572 -0.256022940  0.6508784
5   Choubenkova (URS)(4) 1.5357870  0.9824589 -1.818885157  0.8008982
6        Schulz (GDR)(6) 0.9790817  0.3587703 -0.421970960 -1.1374969
      Comp.5      Comp.6      Comp.7 score rank
1  0.3696153 -0.27632076  0.48611032  7291    1
2 -0.7698539  0.38582368  0.05283965  6897    2
3  0.1944444 -0.26334765 -0.11292729  6858    3
4 -0.6166041 -0.22039763 -0.54216684  6540    4
5 -0.6023826  0.08186703  0.30728837  6540    4
6 -0.7302135 -0.25984050 -0.03921361  6411    6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df_pca<span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Comp<span class="fl">.1</span>, <span class="at">y=</span>Comp<span class="fl">.2</span> , <span class="at">label=</span>label, <span class="at">size=</span>score)) <span class="sc">+</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">size=</span> <span class="dv">3</span> ,<span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">alpha=</span><span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"PCA 1"</span>, <span class="at">y=</span><span class="st">"PCA 2"</span>, <span class="at">title =</span> <span class="st">"주성분 점수 산점도"</span>)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-pca_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Biplot</strong> 은 25개의 개체에 대하여 2개의 주성분 점수와 그 방향을 이차원 공간에 표시한 그림으로 주성분의 구조를 이해하는데 큰 도움이 된다. Biplot 은 패키지 <code>ggfortify</code> 의 <code>autoplot</code> 함수를 이용하면 다음과 같이 그릴 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(pca1, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">loadings =</span> <span class="cn">TRUE</span>, <span class="at">loadings.label =</span> <span class="cn">TRUE</span>)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-pca_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>화살표로 표시된 각 변수에 대한 방향 벡터는 2개의 주성분 계수들 중 각 변수에 해당하는 두 계수(<code>Comp.1</code>, <code>Comp.2</code>) 벡터의 방향이다. 위의 Biplot에서 다음과 같은 사실을 알 수 있다.</p>
<ul>
<li><p>각 변수에 대한 벡터의 방향은 두 주성분의 축에서 더 평행한 방향으로 주성분 점수에 기여도가 높다.</p></li>
<li><p>각 변수에 대한 벡터의 각도는 상관성을 나타내며 그 각이 작을수록 상관관계가 크다.</p></li>
<li><p>첫번째 주성분은 <code>hurdle</code>, <code>longjump</code>, <code>200m</code>가 변동을 주로 설명한다.</p>
<ul>
<li>선수 Joyner가 오른쪽 끝에 위치하는 것은 첫번째 주성분 점수가 가장 크고 <code>hurdle</code>, <code>longjump</code>, <code>200m</code> 에서 좋은 점수를 낸것을 알려준다.</li>
</ul></li>
<li><p>두번째 주성분은 <code>800m</code>와 <code>highjump</code>가 변동을 주로 설명하며 두 변수의 상관관계가 상대적으로 작으므로 방향이 반대인 것을 알 수 있다.</p>
<ul>
<li><code>800m</code>와 <code>highjump</code> 벡터 방향이 서로 반대이며 각 벡터 방향에 가까운 선수들이 해당 종목의 점수가 높음을 알 수 있다.</li>
<li>예를 들어 선수 Yuping 은 <code>highjump</code> 점수가 높으므로 <code>highjump</code> 방향인 아래쪽에 위치하고 있다.</li>
</ul></li>
</ul>
<p>마지막으로 첫번째 주성분 점수와 올림픽 위원회가 구한 총점과의 관계를 보자. 두 값이 매우 강한 상관관계를 나타낸다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(df_1<span class="sc">$</span>score, df_pca<span class="sc">$</span><span class="st">`</span><span class="at">Comp.1</span><span class="st">`</span>)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9931168</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df_1<span class="sc">$</span>score, df_pca<span class="sc">$</span><span class="st">`</span><span class="at">Comp.1</span><span class="st">`</span>, <span class="at">xlab=</span><span class="st">"Olympic Score"</span>, <span class="at">ylab=</span><span class="st">"PCA1"</span>)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-pca_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="예제-포도주-자료" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="예제-포도주-자료"><span class="header-section-number">6.5</span> 예제: 포도주 자료</h2>
<p>포도주 자료는 먼저 1978년에 이탈리아 피에몬테(Piedmont) 지역에서 재배된 세 가지 포도 품종(cultivar) 와인의 화학 성분을 측정한 자료이다. 전체 178 걔의 와인이 3개의 그룹으로 나누어저 있다. 변수 <code>Class</code> 는 포도의 품종을 나타내는 범주형 변수이다.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><code>Class</code></th>
<th>포도 품종(지역)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Barolo (바롤로)</td>
</tr>
<tr class="even">
<td>2</td>
<td>Grignolino (그리뇰리노)</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Barbera (바르베라)</td>
</tr>
</tbody>
</table>
<p>포도주 자료는 사용와인의 화학 조성을 기반으로 주요 성분 간 상관관계를 분석할 수 있으며 포도 품종 간 차이 비교하는데 사용된다. 차원 축소(PCA) 및 군집 분석에 자주 사용되는 자료이다.</p>
<p>13개의 변수에 대한 설명은 다음과 같다.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 77%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">변수명</th>
<th style="text-align: left;">설명</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>Class</code></td>
<td style="text-align: left;">포도 품종 (1, 2, 3 세 가지 품종 구분)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Alcohol</code></td>
<td style="text-align: left;">알코올 함량 (%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>Malic_Acid</code></td>
<td style="text-align: left;">사과산 함량 – 와인의 신맛을 결정하는 유기산</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Ash</code></td>
<td style="text-align: left;">회분 – 무기질 함량 지표</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>Alcalinity_of_Ash</code></td>
<td style="text-align: left;">회분의 알칼리도 – 산-알칼리 균형 지표</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Magnesium</code></td>
<td style="text-align: left;">마그네슘 함량 (mg/L)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>Total_Phenols</code></td>
<td style="text-align: left;">총 페놀 성분 – 향, 맛, 항산화 효과에 기여</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Flavanoids</code></td>
<td style="text-align: left;">플라보노이드 성분 – 떫은맛, 색, 향과 관련</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>Nonflavanoid_Phenols</code></td>
<td style="text-align: left;">비플라보노이드 페놀 성분</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Proanthocyanins</code></td>
<td style="text-align: left;">프로안토시아닌 – 탄닌 전구체, 색과 떫은맛 영향</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>Color_Intensity</code></td>
<td style="text-align: left;">색 농도 – 와인의 색상이 얼마나 짙은지</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Hue</code></td>
<td style="text-align: left;">색조 – 적색 대비 황색 비율</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>OD280_OD315</code></td>
<td style="text-align: left;">280nm/315nm 흡광도 비율 – 페놀 함량 및 품질 지표</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Proline</code></td>
<td style="text-align: left;">프롤린 함량 – 아미노산, 와인 향과 숙성에 중요한 역할</td>
</tr>
</tbody>
</table>
<section id="자료-불러오기" class="level3" data-number="6.5.1">
<h3 data-number="6.5.1" class="anchored" data-anchor-id="자료-불러오기"><span class="header-section-number">6.5.1</span> 자료 불러오기</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://archive.ics.uci.edu/ml/machine-learning-databases/wine/wine.data"</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>wine <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(url, <span class="at">header =</span> <span class="cn">FALSE</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add column names from UCI description</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(wine) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Class"</span>,<span class="st">"Alcohol"</span>,<span class="st">"Malic_Acid"</span>,<span class="st">"Ash"</span>,<span class="st">"Alcalinity_Ash"</span>,<span class="st">"Magnesium"</span>,</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Total_Phenols"</span>,<span class="st">"Flavanoids"</span>,<span class="st">"Nonflav_Phenols"</span>,<span class="st">"Proanthocyanins"</span>,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Color_Intensity"</span>,<span class="st">"Hue"</span>,<span class="st">"OD280_OD315"</span>,<span class="st">"Proline"</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(wine)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Class Alcohol Malic_Acid  Ash Alcalinity_Ash Magnesium Total_Phenols
1     1   14.23       1.71 2.43           15.6       127          2.80
2     1   13.20       1.78 2.14           11.2       100          2.65
3     1   13.16       2.36 2.67           18.6       101          2.80
4     1   14.37       1.95 2.50           16.8       113          3.85
5     1   13.24       2.59 2.87           21.0       118          2.80
6     1   14.20       1.76 2.45           15.2       112          3.27
  Flavanoids Nonflav_Phenols Proanthocyanins Color_Intensity  Hue OD280_OD315
1       3.06            0.28            2.29            5.64 1.04        3.92
2       2.76            0.26            1.28            4.38 1.05        3.40
3       3.24            0.30            2.81            5.68 1.03        3.17
4       3.49            0.24            2.18            7.80 0.86        3.45
5       2.69            0.39            1.82            4.32 1.04        2.93
6       3.39            0.34            1.97            6.75 1.05        2.85
  Proline
1    1065
2    1050
3    1185
4    1480
5     735
6    1450</code></pre>
</div>
</div>
<p>먼저 품종(<code>Class</code>)을 제외한 13개의 변수의 상관계수 행렬을 시각화 해보자.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 품종 제외한 변수 선택</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>df_2 <span class="ot">&lt;-</span> wine <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Class)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 상관계수 행렬 계산</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>cor_mat <span class="ot">&lt;-</span> <span class="fu">cor</span>(df_2, <span class="at">use=</span><span class="st">"pairwise.complete.obs"</span>) </span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 히트맵 그리기</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(cor_mat,  <span class="at">display_numbers =</span> <span class="cn">TRUE</span>, <span class="at">number_format =</span> <span class="st">"%.2f"</span>)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-pca_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>상관계수 행렬을 보먄 변수들이 3개의 그룹으로 나누어져 있다것을 알 수 있다.</p>
</section>
<section id="주성분-분석-1" class="level3" data-number="6.5.2">
<h3 data-number="6.5.2" class="anchored" data-anchor-id="주성분-분석-1"><span class="header-section-number">6.5.2</span> 주성분 분석</h3>
<p>이제 <code>wine</code> 자료에 대하여 주성분 분석을 적용해 보자.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>pca_wine <span class="ot">&lt;-</span> <span class="fu">princomp</span>(df_2, <span class="at">cor =</span> <span class="cn">TRUE</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pca_wine, <span class="at">loadings =</span> <span class="cn">TRUE</span>)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Importance of components:
                          Comp.1    Comp.2    Comp.3    Comp.4     Comp.5
Standard deviation     2.1692972 1.5801816 1.2025273 0.9586313 0.92370351
Proportion of Variance 0.3619885 0.1920749 0.1112363 0.0706903 0.06563294
Cumulative Proportion  0.3619885 0.5540634 0.6652997 0.7359900 0.80162293
                           Comp.6     Comp.7     Comp.8     Comp.9    Comp.10
Standard deviation     0.80103498 0.74231281 0.59033665 0.53747553 0.50090167
Proportion of Variance 0.04935823 0.04238679 0.02680749 0.02222153 0.01930019
Cumulative Proportion  0.85098116 0.89336795 0.92017544 0.94239698 0.96169717
                          Comp.11    Comp.12     Comp.13
Standard deviation     0.47517222 0.41081655 0.321524394
Proportion of Variance 0.01736836 0.01298233 0.007952149
Cumulative Proportion  0.97906553 0.99204785 1.000000000

Loadings:
                Comp.1 Comp.2 Comp.3 Comp.4 Comp.5 Comp.6 Comp.7 Comp.8 Comp.9
Alcohol          0.144  0.484  0.207         0.266  0.214         0.396  0.509
Malic_Acid      -0.245  0.225        -0.537         0.537 -0.421              
Ash                     0.316 -0.626  0.214  0.143  0.154  0.149 -0.170 -0.308
Alcalinity_Ash  -0.239        -0.612               -0.101  0.287  0.428  0.200
Magnesium        0.142  0.300 -0.131  0.352 -0.727        -0.323 -0.156  0.271
Total_Phenols    0.395        -0.146 -0.198  0.149               -0.406  0.286
Flavanoids       0.423        -0.151 -0.152  0.109               -0.187       
Nonflav_Phenols -0.299        -0.170  0.203  0.501 -0.259 -0.595 -0.233  0.196
Proanthocyanins  0.313        -0.149 -0.399 -0.137 -0.534 -0.372  0.368 -0.209
Color_Intensity         0.530  0.137               -0.419  0.228              
Hue              0.297 -0.279         0.428  0.174  0.106 -0.232  0.437       
OD280_OD315      0.376 -0.164 -0.166 -0.184  0.101  0.266                0.137
Proline          0.287  0.365  0.127  0.232  0.158  0.120         0.120 -0.576
                Comp.10 Comp.11 Comp.12 Comp.13
Alcohol          0.212   0.226   0.266         
Malic_Acid      -0.309          -0.122         
Ash                      0.499          -0.141 
Alcalinity_Ash          -0.479                 
Magnesium                                      
Total_Phenols   -0.320  -0.304   0.304  -0.464 
Flavanoids      -0.163                   0.832 
Nonflav_Phenols  0.216  -0.117           0.114 
Proanthocyanins  0.134   0.237          -0.117 
Color_Intensity -0.291          -0.604         
Hue             -0.522          -0.259         
OD280_OD315      0.524          -0.601  -0.157 
Proline          0.162  -0.539                 </code></pre>
</div>
</div>
<ul>
<li><p>첫 번째 주성분의 계수를 보면 <code>Flavanoids</code> , <code>Total_Phenols</code>, <code>OD280_OD315</code>, <code>Proanthocyanins</code> 의 계수값이 양수로 다른 변수들에 비하여 상재적으로 크게 나타난 것을 알 수 있다. 또한 앞의 상관관계 분석에서도 4개 변수들의 상관관계가 높다는 것을 알 수 있다. 4개의 변수들은 맛의 풍부함 또는 맛의 강도와 관련된 변수들이다.</p></li>
<li><p>두번째 주성분의 계수를 보면 <code>Color_Intensity</code> , <code>Alcohol</code>, <code>Ash</code>, <code>Hue</code> 의 계수값이 양수로서 다른 변수들에 비하여 상대적으로 크게 나타난 것을 알 수 있다. 이러한 변수들는 서로 상관관계가 높다는 것을 알 수 있다. 이 변수들 중 <code>Color_Intensity</code> 와 <code>Hue</code> 는 색상에 관련된 특성을 가지고 있다.</p></li>
</ul>
<p>자료의 변동을 설명하는 비율을 보기 위해서 scree plot 을 만들어 보자. 앞의 결과에서 보았듯이 두 개의 주성분이 55%의 변동을 설명한다</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca_wine, <span class="at">main =</span> <span class="st">"scree plot"</span>)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-pca_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Biplot 은 178개의 포도주 샘플에 대하여 2개의 주성분 점수와 그 방향을 이차원 공간에 표시한 그림으로 주성분의 구조를 이해하는데 큰 도움이 된다. 아래 그림에서 보듯이 첫 번째 주성분과 두 번쨰 주성분을 구성하는 변수들의 역할을 시각화하여 볼 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(pca_wine, <span class="at">label =</span> <span class="cn">FALSE</span>, <span class="at">loadings =</span> <span class="cn">TRUE</span>, <span class="at">loadings.label =</span> <span class="cn">TRUE</span>)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-pca_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>이제 마지막으로 주성분 분석을 통해 얻은 2개의 주성분 점수를 이용하여 포도 품종 간의 차이를 비교해 보자. 14개의 변수가 아닌 2개의 주성분으로 차원을 축소했음에도 불구하고 3개의 품종이 잘 구분되는 것을 알 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">#- 주성분 점수 데이터프레임 생성</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>df_pca <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(pca_wine<span class="sc">$</span>scores)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co">#- 품종 정보를 데이터프레임에 추가</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>df_pca<span class="sc">$</span>Class <span class="ot">&lt;-</span> <span class="fu">factor</span>(wine<span class="sc">$</span>Class)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="co">#- 주성분 점수 산점도 그리기</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_pca, <span class="fu">aes</span>(Comp<span class="fl">.1</span>, Comp<span class="fl">.2</span>, <span class="at">color =</span> Class)) <span class="sc">+</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"PCA on Wine dataset"</span>)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multivar-pca_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "복사완료!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "복사완료!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation column-page-right">
  <div class="nav-page nav-page-previous">
      <a href="../qmd/multivar-discrim.html" class="pagination-link" aria-label="판별분석">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">판별분석</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../qmd/multivar-cancor.html" class="pagination-link" aria-label="정준상관분석">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">정준상관분석</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>